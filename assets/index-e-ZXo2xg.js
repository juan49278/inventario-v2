var et=Object.defineProperty;var tt=(g,t,h)=>t in g?et(g,t,{enumerable:!0,configurable:!0,writable:!0,value:h}):g[t]=h;var $e=(g,t,h)=>tt(g,typeof t!="symbol"?t+"":t,h);import{j as e,P as K,D as st,Z as qe,C as te,A as Q,m as I,L as at,a as Z,b as xe,M as we,c as rt,E as ot,d as Ve,e as Ie,U as pe,f as Ce,X,g as it,S as me,h as he,i as ie,B as nt,k as J,l as ce,n as je,o as lt,p as ct,T as Ee,q as dt,r as Re,H as ze,s as ut,t as mt,u as Se,I as xt,v as gt,R as fe,w as pt,x as Ue,y as be,z as Be,F as ht,G as ye,J as ft,K as Le,N as bt}from"./ui-BuOCF-HA.js";import{a as yt,r as a,R as le}from"./vendor-B6114-rA.js";import{c as jt}from"./supabase-CywIIHyy.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function h(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(r){if(r.ep)return;r.ep=!0;const s=h(r);fetch(r.href,s)}})();var Ge,_e=yt;Ge=_e.createRoot,_e.hydrateRoot;const He="https://adkulstcretguqsfqpht.supabase.co",Je="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFka3Vsc3RjcmV0Z3Vxc2ZxcGh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4NTA0ODcsImV4cCI6MjA2NzQyNjQ4N30.Tnonh49OCVHsUR1OjyE5D1GEvfY1VAWFJLblYbuaU1U";console.log("üîß Supabase Configuration:");console.log("URL:",He);console.log("Anon Key:",`${Je.substring(0,20)}...`);const F=jt(He,Je);F.from("productos").select("count",{count:"exact",head:!0}).then(({count:g,error:t})=>{t?console.error("Error conectando a Supabase:",t):(console.log("Conexi√≥n exitosa a Supabase. Total productos:",g),F.from("productos").select("*").ilike("Producto","%arroz%").limit(3).then(({data:h,error:l})=>{l?console.error("Error en test de b√∫squeda:",l):console.log('Test de b√∫squeda exitoso. Productos con "arroz":',h)}))});const vt=3,Fe=10*60*1e3,Ne="login_attempts",Nt="login_lockout",Qe=a.createContext(void 0),se=()=>{const g=a.useContext(Qe);if(g===void 0)throw new Error("useAuth must be used within an AuthProvider");return g},re=30*60*1e3,wt=5*60*1e3,Pe="inventory_remember_user",Ct=({children:g})=>{const[t,h]=a.useState(null),[l,r]=a.useState(!0),[s,d]=a.useState(null),[p,o]=a.useState(re),[f,c]=a.useState(!1),[b,u]=a.useState(0),[y,w]=a.useState(null),m=a.useRef(null),N=a.useRef(null),E=a.useRef(null),S=a.useRef(!1),T=a.useRef(null),j=()=>{try{const n=localStorage.getItem(Ne);if(n)return JSON.parse(n)}catch(n){console.error("Error reading login attempts:",n)}return{count:0,lastAttempt:new Date().toISOString()}},x=n=>{try{localStorage.setItem(Ne,JSON.stringify(n))}catch(i){console.error("Error saving login attempts:",i)}},C=()=>{try{localStorage.removeItem(Ne),localStorage.removeItem(Nt)}catch(n){console.error("Error clearing login attempts:",n)}},P=()=>{const n=j();if(n.lockedUntil){const i=new Date(n.lockedUntil),v=new Date;return v<i?(c(!0),u(i.getTime()-v.getTime()),!0):(C(),c(!1),u(0),!1)}return c(!1),u(0),!1},$=()=>{const i=j().count+1,v=new Date;if(i>=vt){const A=new Date(v.getTime()+Fe),q={count:i,lastAttempt:v.toISOString(),lockedUntil:A.toISOString()};return x(q),c(!0),u(Fe),!0}else{const A={count:i,lastAttempt:v.toISOString()};return x(A),!1}};a.useEffect(()=>{if(f&&b>0)return T.current=setInterval(()=>{u(n=>{const i=n-1e3;return i<=0?(c(!1),C(),0):i})},1e3),()=>{T.current&&clearInterval(T.current)}},[f,b]),a.useEffect(()=>{P()},[]);const L=()=>{if(S.current)return;S.current=!0,window.confirm(`‚ö†Ô∏è ADVERTENCIA DE SESI√ìN

Tu sesi√≥n expirar√° en 5 minutos por inactividad.

¬øDeseas mantener tu sesi√≥n activa?

‚Ä¢ S√ç: Renovar sesi√≥n
‚Ä¢ NO: Cerrar sesi√≥n autom√°ticamente`)?(M(),S.current=!1):R()},V=()=>{alert(`üîí SESI√ìN EXPIRADA

Tu sesi√≥n ha expirado por inactividad (30 minutos).

Por seguridad, debes iniciar sesi√≥n nuevamente.`),R()},M=()=>{d(new Date),o(re),S.current=!1,m.current&&clearTimeout(m.current),N.current&&clearTimeout(N.current),t!=null&&t.isAuthenticated&&(N.current=setTimeout(()=>{L()},re-wt),m.current=setTimeout(()=>{V()},re))},G=()=>{t!=null&&t.isAuthenticated&&M()};a.useEffect(()=>{if(t!=null&&t.isAuthenticated&&s)return E.current=setInterval(()=>{const i=new Date().getTime()-s.getTime(),v=re-i;v>0?o(v):o(0)},1e3),()=>{E.current&&clearInterval(E.current)}},[t==null?void 0:t.isAuthenticated,s]),a.useEffect(()=>{if(t!=null&&t.isAuthenticated){const n=["mousedown","mousemove","keypress","scroll","touchstart","click"];return n.forEach(i=>{document.addEventListener(i,G,!0)}),M(),()=>{n.forEach(i=>{document.removeEventListener(i,G,!0)}),m.current&&clearTimeout(m.current),N.current&&clearTimeout(N.current),E.current&&clearInterval(E.current)}}},[t==null?void 0:t.isAuthenticated]),a.useEffect(()=>{F.auth.getSession().then(({data:{session:i}})=>{i!=null&&i.user&&h({id:i.user.id,username:i.user.email||"",email:i.user.email||"",role:"admin",isAuthenticated:!0}),r(!1)});const{data:{subscription:n}}=F.auth.onAuthStateChange((i,v)=>{v!=null&&v.user?h({id:v.user.id,username:v.user.email||"",email:v.user.email||"",role:"admin",isAuthenticated:!0}):(h(null),d(null),o(re)),r(!1)});return()=>n.unsubscribe()},[]);const U=async(n,i,v=!1)=>{if(P())return!1;try{const{data:A,error:q}=await F.auth.signInWithPassword({email:n,password:i});if(q){console.error("Login error:",q);const H=$();return!1}if(A.user){if(h({id:A.user.id,username:A.user.email||"",email:A.user.email||"",role:"admin",isAuthenticated:!0}),v)try{localStorage.setItem(Pe,JSON.stringify({email:n,timestamp:new Date().toISOString()}))}catch(H){console.error("Error saving remember user:",H)}else try{localStorage.removeItem(Pe)}catch(H){console.error("Error removing remember user:",H)}return C(),!0}return!1}catch(A){return console.error("Login error:",A),!1}},R=async()=>{try{m.current&&clearTimeout(m.current),N.current&&clearTimeout(N.current),E.current&&clearInterval(E.current),await F.auth.signOut(),h(null),d(null),o(re),S.current=!1,T.current&&clearInterval(T.current)}catch(n){console.error("Logout error:",n)}};return e.jsx(Qe.Provider,{value:{user:t,userProfile:null,login:U,logout:R,isLoading:l,lastActivity:s,timeUntilLogout:p,isLocked:f,lockoutTimeRemaining:b},children:g})},St=()=>{try{const g=localStorage.getItem(Pe);if(g)return JSON.parse(g).email||""}catch{}return""},Pt=({onComplete:g})=>{const[t,h]=a.useState(0),[l,r]=a.useState(!1),s=[{icon:K,label:"Iniciando Sistema",color:"text-blue-500"},{icon:st,label:"Conectando Base de Datos",color:"text-green-500"},{icon:qe,label:"Cargando Componentes",color:"text-yellow-500"},{icon:te,label:"Sistema Listo",color:"text-emerald-500"}];return a.useEffect(()=>{const d=setInterval(()=>{h(p=>p<s.length-1?p+1:(r(!0),setTimeout(()=>g(),800),p))},800);return()=>clearInterval(d)},[g]),e.jsx(Q,{children:e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex items-center justify-center z-50",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:[...Array(20)].map((d,p)=>e.jsx(I.div,{className:"absolute w-2 h-2 bg-white/20 rounded-full",initial:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight},animate:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight},transition:{duration:Math.random()*10+10,repeat:1/0,ease:"linear"}},p))}),e.jsxs("div",{className:"relative z-10 text-center",children:[e.jsx(I.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{duration:1,type:"spring",stiffness:200},className:"mb-8",children:e.jsx("div",{className:"w-24 h-24 mx-auto bg-gradient-to-r from-blue-400 to-purple-500 rounded-2xl flex items-center justify-center shadow-2xl",children:e.jsx(K,{className:"w-12 h-12 text-white"})})}),e.jsx(I.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.8},className:"text-4xl font-bold text-white mb-2",children:"Sistema de Inventario"}),e.jsx(I.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7,duration:.8},className:"text-xl text-blue-200 mb-12",children:"Gesti√≥n Moderna v6.0"}),e.jsx("div",{className:"space-y-4 mb-8",children:s.map((d,p)=>{const o=d.icon,f=p<=t,c=p===t;return e.jsxs(I.div,{initial:{opacity:0,x:-50},animate:{opacity:f?1:.3,x:0,scale:c?1.05:1},transition:{delay:p*.2,duration:.5},className:`flex items-center justify-center space-x-3 ${f?"text-white":"text-gray-400"}`,children:[e.jsx(I.div,{animate:c?{rotate:360,scale:[1,1.2,1]}:{},transition:{rotate:{duration:1,repeat:1/0,ease:"linear"},scale:{duration:.5,repeat:1/0}},className:`p-2 rounded-full ${f?"bg-white/20":"bg-gray-600/20"}`,children:e.jsx(o,{className:`w-5 h-5 ${f?d.color:"text-gray-400"}`})}),e.jsx("span",{className:"text-lg font-medium",children:d.label}),f&&p<t&&e.jsx(I.div,{initial:{scale:0},animate:{scale:1},className:"text-green-400",children:e.jsx(te,{className:"w-5 h-5"})})]},p)})}),e.jsx("div",{className:"w-64 mx-auto bg-white/20 rounded-full h-2 overflow-hidden",children:e.jsx(I.div,{className:"h-full bg-gradient-to-r from-blue-400 to-purple-500",initial:{width:0},animate:{width:`${(t+1)/s.length*100}%`},transition:{duration:.5}})}),e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"mt-4 text-white/80",children:[Math.round((t+1)/s.length*100),"%"]}),l&&e.jsx(I.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"mt-8 text-green-400 font-semibold text-lg",children:"¬°Sistema iniciado correctamente!"})]})]})})},kt=()=>{const[g,t]=a.useState(""),[h,l]=a.useState(""),[r,s]=a.useState(!1),[d,p]=a.useState(!1),[o,f]=a.useState(""),[c,b]=a.useState(!1),{login:u,isLocked:y,lockoutTimeRemaining:w}=se(),m=St();a.useEffect(()=>{m&&(t(m),s(!0))},[m]);const N=async S=>{if(S.preventDefault(),!y){f(""),b(!0);try{await u(g,h,r)||f(y?"":"La combinaci√≥n de email y contrase√±a no es correcta. Por favor, verifica tus credenciales e intenta nuevamente.")}catch{f("Error al conectar con el servidor. Por favor, intenta de nuevo.")}finally{b(!1)}}},E=S=>{const T=Math.floor(S/6e4),j=Math.floor(S%6e4/1e3);return`${T}:${j.toString().padStart(2,"0")}`};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-800 flex items-center justify-center px-4",children:e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-md w-full",children:[e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(I.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"mx-auto h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center mb-4",children:e.jsx(at,{className:"h-8 w-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"¬°Bienvenido!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Ingresa tus credenciales para continuar"}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-blue-800",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Conexi√≥n segura y protegida"})]})})]}),y&&e.jsx(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(xe,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-2",children:"üîí Acceso Temporalmente Inhabilitado"}),e.jsx("p",{className:"text-sm text-red-700 mb-2",children:"Se han detectado demasiados intentos de acceso incorrectos."}),e.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Por seguridad, el acceso est√° inhabilitado temporalmente."}),e.jsxs("div",{className:"bg-red-100 p-3 rounded-md",children:[e.jsxs("p",{className:"text-sm font-medium text-red-800",children:["‚è±Ô∏è Tiempo restante: ",e.jsx("span",{className:"font-mono text-lg",children:E(w)})]}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Podr√°s intentar nuevamente cuando expire este tiempo."})]})]})]})}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(we,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"email",type:"email",value:g,onChange:S=>t(S.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Ingresa tu email",disabled:y,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Contrase√±a"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(rt,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"password",type:d?"text":"password",value:h,onChange:S=>l(S.target.value),className:"block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Ingresa tu contrase√±a",disabled:y,required:!0}),e.jsx("button",{type:"button",onClick:()=>p(!d),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors",children:d?e.jsx(ot,{className:"h-5 w-5"}):e.jsx(Ve,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"remember-user",type:"checkbox",checked:r,onChange:S=>s(S.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:y}),e.jsx("label",{htmlFor:"remember-user",className:"ml-2 block text-sm text-gray-700",children:"Recordar mi email"})]}),o&&e.jsxs(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-start space-x-2 text-red-600 text-sm bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx(xe,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error de autenticaci√≥n"}),e.jsx("p",{className:"mt-1",children:o})]})]}),e.jsx(I.button,{type:"submit",disabled:c||y,whileHover:{scale:1.02},whileTap:{scale:.98},className:`w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 ${y?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:y?e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Bloqueado temporalmente"]}):c?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Iniciando sesi√≥n..."]}):"Iniciar Sesi√≥n"})]}),e.jsxs("div",{className:"mt-6 text-center text-sm text-gray-500 space-y-2",children:[e.jsx("p",{children:"üîí Conexi√≥n segura con cifrado SSL"}),e.jsx("p",{children:"‚è±Ô∏è Sesi√≥n con tiempo de vida limitado"}),e.jsx("p",{children:"üõ°Ô∏è Protecci√≥n contra accesos no autorizados"}),e.jsx("p",{children:"üõ°Ô∏è Tus datos est√°n protegidos"})]})]}),e.jsxs("div",{className:"mt-8 mb-4 text-center text-white/80 text-sm",children:[e.jsx("p",{children:"Sistema de Inventario v6.0.1"}),e.jsx("p",{children:"Dise√±o y desarrollo por Juan Mart√≠nez"}),e.jsx("p",{children:"¬©2025 Todos los derechos reservados"})]})]})})},Ke=()=>{const[g,t]=a.useState(null),[h,l]=a.useState([]),[r,s]=a.useState(!0),[d,p]=a.useState(!1),{user:o}=se(),f=async()=>{if(o!=null&&o.id)try{s(!0);const{data:m,error:N}=await F.from("user_profiles").select("*").eq("user_id",o.id).single();if(N&&N.code!=="PGRST116"){console.error("Error loading profile:",N);return}m?t(m):await c()}catch(m){console.error("Error loading profile:",m)}finally{s(!1)}},c=async()=>{if(!(!(o!=null&&o.id)||!(o!=null&&o.username)))try{const m=o.username.split("@")[0],{data:N,error:E}=await F.from("user_profiles").insert({user_id:o.id,email:o.username,display_name:m,preferences:{}}).select().single();if(E)throw E;t(N),console.log("‚úÖ Perfil creado:",N)}catch(m){console.error("Error creating profile:",m)}},b=async m=>{if(!(o!=null&&o.id)||!g)return!1;try{p(!0);const{data:N,error:E}=await F.from("user_profiles").update(m).eq("user_id",o.id).select().single();if(E)throw E;return t(N),console.log("‚úÖ Perfil actualizado:",N),!0}catch(N){return console.error("Error updating profile:",N),!1}finally{p(!1)}},u=async(m=10)=>{if(o!=null&&o.id)try{const{data:N,error:E}=await F.from("login_logs").select("*").eq("user_id",o.id).order("login_time",{ascending:!1}).limit(m);if(E)throw E;l(N||[]),console.log("üìä Login logs cargados:",(N==null?void 0:N.length)||0)}catch(N){console.error("Error loading login logs:",N)}},y=async()=>{if(!(o!=null&&o.id)||!(o!=null&&o.username))return null;try{const m=navigator.userAgent,N="",{data:E,error:S}=await F.rpc("log_user_login",{p_email:o.username,p_ip_address:N||"",p_user_agent:m||"",p_user_id:o.id});if(S)throw S;return console.log("üìù Login registrado:",E),E}catch(m){return console.error("Error logging login:",m),null}},w=async m=>{if(m)try{const{error:N}=await F.rpc("log_user_logout",{p_log_id:m});if(N)throw N;console.log("üìù Logout registrado:",m)}catch(N){console.error("Error logging logout:",N)}};return a.useEffect(()=>{o!=null&&o.id&&(f(),u())},[o==null?void 0:o.id]),{profile:g,loginLogs:h,loading:r,saving:d,updateProfile:b,loadLoginLogs:u,logLogin:y,logLogout:w,refreshProfile:f}},Te=({currentView:g="inventory",onViewChange:t})=>{const[h,l]=a.useState(!1),{user:r,logout:s,timeUntilLogout:d}=se(),{profile:p,logLogin:o,logLogout:f}=Ke(),[c,b]=a.useState(!1),[u,y]=a.useState(null);a.useEffect(()=>{r!=null&&r.isAuthenticated&&!u&&o().then(S=>{S&&y(S)})},[r==null?void 0:r.isAuthenticated,o,u]);const w=()=>{u&&f(u),s(),l(!1),y(null)},m=()=>{var S;return p!=null&&p.display_name?p.display_name:((S=r==null?void 0:r.username)==null?void 0:S.split("@")[0])||"Usuario"},N=S=>{const T=Math.floor(S/6e4),j=Math.floor(S%6e4/1e3);return T>5?`${T} min`:T>0?`${T}:${j.toString().padStart(2,"0")}`:`${j}s`},E=S=>{const T=Math.floor(S/6e4);return T>10?"text-green-600":T>5?"text-yellow-600":"text-red-600"};return a.useEffect(()=>{const S=Math.floor(d/6e4);S<=5&&S>0?b(!0):S>5&&b(!1)},[d]),e.jsx("header",{className:"bg-white/95 backdrop-blur-sm shadow-lg border-b border-gray-200 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center",children:e.jsx(K,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Inventario"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sistema de Gesti√≥n v6.0.1"})]})]}),g==="products"&&t&&e.jsxs("button",{onClick:()=>t("inventory"),className:"hidden md:flex items-center px-3 py-2 text-sm text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Volver al Inventario"]}),e.jsxs("div",{className:"hidden md:flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Bienvenido, ",m()]})]})}),e.jsxs("div",{className:"flex items-center space-x-1 cursor-pointer",onClick:()=>b(!c),title:"Tiempo restante de sesi√≥n",children:[e.jsx(Z,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:`text-xs font-medium ${E(d)}`,children:N(d)})]})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("button",{onClick:w,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-lg text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition-colors duration-200",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Cerrar Sesi√≥n"]})]}),e.jsx("div",{className:"md:hidden",children:e.jsx("button",{onClick:()=>l(!h),className:"inline-flex items-center justify-center p-2 rounded-lg text-gray-400 hover:text-gray-500 hover:bg-gray-100 transition-colors duration-200",children:h?e.jsx(X,{className:"h-6 w-6"}):e.jsx(it,{className:"h-6 w-6"})})})]}),h&&e.jsx(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"md:hidden py-4 border-t border-gray-200",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center space-x-2 text-sm text-gray-600 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Bienvenido, ",m()]})]})}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 px-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Sesi√≥n: "}),e.jsx("span",{className:`font-medium ${E(d)}`,children:N(d)})]}),e.jsxs("button",{onClick:w,className:"w-full text-left px-2 py-2 text-sm text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors duration-200 flex items-center",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Cerrar Sesi√≥n"]})]})}),e.jsx(Q,{children:c&&e.jsxs(I.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t border-gray-200 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"Sesi√≥n segura activa"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Tiempo restante:"}),e.jsx("span",{className:`font-semibold ${E(d)}`,children:N(d)})]})]}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(X,{className:"h-4 w-4"})})]}),Math.floor(d/6e4)<=5&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-xs text-yellow-800",children:"‚ö†Ô∏è Tu sesi√≥n expirar√° pronto. Cualquier actividad renovar√° autom√°ticamente tu sesi√≥n."})})]})})]})})},Ye=a.forwardRef(({onSearch:g,onInputChange:t,onEnter:h,placeholder:l="Buscar productos...",className:r=""},s)=>{const[d,p]=a.useState(""),o=le.useRef(null),f=w=>{w.preventDefault(),h?h(d):g(d)},c=()=>{p(""),g(""),t==null||t("")};le.useImperativeHandle(s,()=>({clear:c,focus:()=>{var w;(w=o.current)==null||w.focus()}})),le.useEffect(()=>{d!==""&&!d&&p("")},[]);const b=w=>{const m=w.target.value;p(m),t==null||t(m)},u=w=>{const m=w.target.value;g(m)},y=w=>{w.key==="Enter"&&h&&(w.preventDefault(),h(d))};return e.jsx("form",{onSubmit:f,className:`relative ${r}`,children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",ref:o,value:d,onInput:b,onChange:u,onKeyDown:y,placeholder:l,className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all duration-200"}),d&&e.jsx("button",{type:"button",onClick:c,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(X,{className:"w-5 h-5"})})]})})});Ye.displayName="SearchBar";const It=({isOpen:g,onClose:t,product:h,onAddToInventory:l,onModalClosed:r})=>{const[s,d]=a.useState(1),[p,o]=a.useState(0),f=le.useRef(null);a.useEffect(()=>{h&&(o(h.price),d(1))},[h]),a.useEffect(()=>{if(g&&f.current){const y=setTimeout(()=>{var w,m;(w=f.current)==null||w.focus(),(m=f.current)==null||m.select()},100);return()=>clearTimeout(y)}},[g]);const c=y=>{if(y.preventDefault(),h&&s>0){const w={...h,price:p};l(w,s),b(),d(1)}},b=()=>{t(),r&&setTimeout(r,150)},u=y=>{y.target===y.currentTarget&&b()};return h?e.jsx(Q,{children:g&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",onClick:u,children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gray-500 bg-opacity-75 backdrop-blur-sm","aria-hidden":"true"}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"‚Äã"}),e.jsxs(I.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2},className:"relative inline-block w-full max-w-md p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl sm:align-middle",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Agregar al Inventario"}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-lg",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(K,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:h.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["C√≥digo: ",h.code]}),h.category&&e.jsx("span",{className:"inline-block mt-1 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full",children:h.category})]})]})}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"quantity",className:"block text-sm font-medium text-gray-700 mb-1",children:"Cantidad"}),e.jsx("input",{ref:f,type:"number",id:"quantity",min:"1",max:"99999",value:s,onChange:y=>d(Number(y.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ie,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"number",id:"price",min:"0",step:"0.01",value:p,onChange:y=>o(Number(y.target.value)),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Nota: Si cambias el precio aqu√≠, solo se reflejar√° en la tabla actual."})]}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsxs("span",{className:"font-semibold text-blue-900",children:["$",(s*p).toFixed(2)]})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 transition-colors duration-200",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",children:"Agregar"})]})]})]})]})})}):null},Et=({isOpen:g,onClose:t,onProductCreated:h,searchCode:l=""})=>{const[r,s]=a.useState({Producto:"",Codigo:l,Codigo1:"",Codigo2:"",Codigo3:"",Codigo4:"",Precio:0,quantity:1}),[d,p]=a.useState(!1),[o,f]=a.useState("");le.useEffect(()=>{l&&s(u=>({...u,Codigo:l}))},[l]);const c=async u=>{if(u.preventDefault(),f(""),!r.Producto.trim()||!r.Codigo.trim()||r.Precio<=0){f("Por favor completa todos los campos requeridos");return}p(!0);try{const{data:y}=await F.from("productos").select("id").eq("Codigo",r.Codigo).limit(1);if(y&&y.length>0){f("Ya existe un producto con este c√≥digo"),p(!1);return}const{data:w,error:m}=await F.from("productos").insert({Producto:r.Producto.trim(),Codigo:r.Codigo.trim(),Codigo1:r.Codigo1.trim()||null,Codigo2:r.Codigo2.trim()||null,Codigo3:r.Codigo3.trim()||null,Codigo4:r.Codigo4.trim()||null,Precio:r.Precio}).select().single();if(m)throw m;const N={id:w.id.toString(),name:w.Producto,code:w.Codigo,code1:w.Codigo1,code2:w.Codigo2,code3:w.Codigo3,code4:w.Codigo4,price:w.Precio,category:"Producto"};h(N,r.quantity),s({Producto:"",Codigo:"",Codigo1:"",Codigo2:"",Codigo3:"",Codigo4:"",Precio:"",quantity:1}),t()}catch(y){console.error("Error creating product:",y),f("Error al crear el producto. Intenta de nuevo.")}finally{p(!1)}},b=u=>{u.target===u.currentTarget&&t()};return e.jsx(Q,{children:g&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",onClick:b,children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gray-500 bg-opacity-75 backdrop-blur-sm","aria-hidden":"true"}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"‚Äã"}),e.jsxs(I.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2},className:"relative inline-block w-full max-w-2xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl sm:align-middle",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(K,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Crear Nuevo Producto"}),e.jsx("p",{className:"text-sm text-gray-500",children:"El producto no existe, vamos a crearlo"})]})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-lg",children:e.jsx(X,{className:"w-5 h-5"})})]}),o&&e.jsx(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:o})}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"producto",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Producto *"}),e.jsx("input",{type:"text",id:"producto",value:r.Producto,onChange:u=>s({...r,Producto:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Coca Cola 2L",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"codigo",className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Principal *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(nt,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",id:"codigo",value:r.Codigo,onChange:u=>s({...r,Codigo:u.target.value}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: 7791234567890",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"precio",className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ie,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"number",id:"precio",min:"0",step:"0.01",value:r.Precio,onChange:u=>s({...r,Precio:parseFloat(u.target.value)||0}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"C√≥digos Alternativos (Opcional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",value:r.Codigo1,onChange:u=>s({...r,Codigo1:u.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"C√≥digo alternativo 1"}),e.jsx("input",{type:"text",value:r.Codigo2,onChange:u=>s({...r,Codigo2:u.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"C√≥digo alternativo 2"}),e.jsx("input",{type:"text",value:r.Codigo3,onChange:u=>s({...r,Codigo3:u.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"C√≥digo alternativo 3"}),e.jsx("input",{type:"text",value:r.Codigo4,onChange:u=>s({...r,Codigo4:u.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"C√≥digo alternativo 4"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("label",{htmlFor:"quantity",className:"block text-sm font-medium text-blue-900 mb-1",children:"Cantidad para Inventario"}),e.jsx("input",{type:"number",id:"quantity",min:"1",max:"99999",value:r.quantity,onChange:u=>s({...r,quantity:parseInt(u.target.value)||1}),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Este producto se agregar√° autom√°ticamente al inventario con esta cantidad"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Resumen:"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Producto:"})," ",r.Producto||"Sin nombre"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"C√≥digo:"})," ",r.Codigo||"Sin c√≥digo"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Precio:"})," $",r.Precio.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cantidad:"})," ",r.quantity]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Subtotal:"})," $",(r.Precio*r.quantity).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 transition-colors duration-200",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:d,className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(J,{className:"w-4 h-4 animate-spin mr-2"}),"Creando..."]}):e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Crear y Agregar"]})})]})]})]})]})})})},Tt=({inventory:g,onRemoveItem:t,onExport:h,total:l})=>{const[r,s]=a.useState("scannedAt"),[d,p]=a.useState("desc"),[o,f]=a.useState(1),[c,b]=a.useState(10),[u,y]=a.useState("all"),w=[{key:"index",label:"#",width:"w-16"},{key:"code",label:"C√≥digo",sortable:!0,width:"w-32"},{key:"name",label:"Producto",sortable:!0,width:"w-64"},{key:"quantity",label:"Cantidad",sortable:!0,width:"w-24"},{key:"price",label:"Precio",sortable:!0,width:"w-24"},{key:"subtotal",label:"Subtotal",sortable:!0,width:"w-28"},{key:"actions",label:"Acciones",width:"w-24"}],m=j=>{r===j?p(d==="asc"?"desc":"asc"):(s(j),p("asc"))},E=[...g].sort((j,x)=>{let C,P;switch(r){case"code":C=j.product.code,P=x.product.code;break;case"name":C=j.product.name,P=x.product.name;break;case"quantity":C=j.quantity,P=x.quantity;break;case"price":C=j.product.price,P=x.product.price;break;case"subtotal":C=j.subtotal,P=x.subtotal;break;default:C=j.scannedAt,P=x.scannedAt}return d==="asc"?C>P?1:-1:C<P?1:-1}).slice((o-1)*c,o*c),S=Math.ceil(g.length/c),T=["all",...Array.from(new Set(g.map(j=>j.product.category).filter(Boolean)))];return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Inventario (",g.length," productos)"]}),e.jsxs("select",{value:c,onChange:j=>b(Number(j.target.value)),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:10,children:"10 por p√°gina"}),e.jsx("option",{value:25,children:"25 por p√°gina"}),e.jsx("option",{value:50,children:"50 por p√°gina"}),e.jsx("option",{value:g.length,children:"Todo"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[T.length>1&&e.jsxs("select",{value:u,onChange:j=>y(j.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Todas las categor√≠as"}),T.filter(j=>j!=="all").map(j=>e.jsx("option",{value:j,children:j},j))]}),e.jsxs("button",{onClick:h,disabled:g.length===0,className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Exportar"]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay productos en el inventario"}),e.jsx("p",{className:"text-gray-500",children:"Comienza agregando productos usando la barra de b√∫squeda"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"üí° Tip: Puedes agregar el mismo producto varias veces para diferentes √°reas"}),e.jsx("p",{className:"text-green-600 text-sm mt-2 font-medium",children:"üíæ Tu inventario se guarda autom√°ticamente en la base de datos"})]}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:w.map(j=>e.jsx("th",{className:`${j.width||""} px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider`,children:j.sortable?e.jsxs("button",{onClick:()=>m(j.key),className:"flex items-center space-x-1 hover:text-gray-700 transition-colors",children:[e.jsx("span",{children:j.label}),r===j.key&&e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},children:d==="asc"?e.jsx(lt,{className:"w-4 h-4"}):e.jsx(ct,{className:"w-4 h-4"})})]}):j.label},j.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.jsx(Q,{children:E.map((j,x)=>e.jsxs(I.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2,delay:x*.05},className:"hover:bg-gray-50 transition-colors duration-150",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(o-1)*c+x+1}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-mono text-gray-900",children:j.product.code})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:j.product.name}),j.product.category&&e.jsx("div",{className:"text-xs text-gray-500",children:j.product.category}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Agregado: ",j.scannedAt.toLocaleTimeString()]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:j.quantity})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",j.product.price.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600",children:["$",j.subtotal.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>t(j.id),className:"text-red-600 hover:text-red-900 transition-colors p-1 hover:bg-red-50 rounded",title:"Eliminar producto",children:e.jsx(Ee,{className:"w-4 h-4"})})})})]},j.id))})})]})}),g.length>0&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",(o-1)*c+1," a"," ",Math.min(o*c,g.length)," de ",g.length," productos"]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["$",l.toFixed(2)]})]}),S>1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>f(j=>Math.max(j-1,1)),disabled:o===1,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["P√°gina ",o," de ",S]}),e.jsx("button",{onClick:()=>f(j=>Math.min(j+1,S)),disabled:o===S,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:"Siguiente"})]})]})]})})]})},At=({onClearInventory:g,onExport:t,onShowHelp:h,onShowProfile:l,onCompleteInventory:r,onViewHistory:s})=>{const[d,p]=a.useState(!1),o=()=>{window.scrollTo({top:0,behavior:"smooth"})},f=[{icon:Ee,label:"Limpiar inventario",onClick:g,className:"bg-red-500 hover:bg-red-600 text-white"},{icon:je,label:"Exportar datos",onClick:t,className:"bg-green-500 hover:bg-green-600 text-white"},...r?[{icon:te,label:"Completar inventario",onClick:r,className:"bg-purple-500 hover:bg-purple-600 text-white"}]:[],{icon:Re,label:"Mi perfil",onClick:l,className:"bg-indigo-500 hover:bg-indigo-600 text-white"},{icon:ze,label:"Ver ayuda",onClick:h,className:"bg-blue-500 hover:bg-blue-600 text-white"},...s?[{icon:ut,label:"Ver historial",onClick:s,className:"bg-indigo-500 hover:bg-indigo-600 text-white"}]:[]];return e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsxs("div",{className:"flex flex-col items-end space-y-3",children:[e.jsx(I.button,{onClick:o,whileHover:{scale:1.1},whileTap:{scale:.9},className:"p-3 bg-gray-600 hover:bg-gray-700 text-white rounded-full shadow-lg transition-colors duration-200",title:"Volver arriba",children:e.jsx(dt,{className:"w-5 h-5"})}),e.jsx(Q,{children:d&&e.jsx(I.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},className:"flex flex-col space-y-2",children:f.map((c,b)=>e.jsxs(I.button,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:b*.05},onClick:()=>{c.onClick(),p(!1)},className:`p-3 rounded-full shadow-lg transition-all duration-200 flex items-center space-x-2 ${c.className}`,title:c.label,whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(c.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium whitespace-nowrap hidden sm:block",children:c.label})]},c.label))})}),e.jsx(I.button,{onClick:()=>p(!d),whileHover:{scale:1.1},whileTap:{scale:.9},className:`p-4 rounded-full shadow-lg transition-all duration-200 ${d?"bg-red-500 hover:bg-red-600 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:e.jsx(I.div,{animate:{rotate:d?45:0},transition:{duration:.2},children:d?e.jsx(ce,{className:"w-6 h-6"}):e.jsx(mt,{className:"w-6 h-6"})})})]})})},Dt=({isOpen:g,onClose:t})=>{const h=l=>{l.target===l.currentTarget&&t()};return e.jsx(Q,{children:g&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",onClick:h,children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gray-500 bg-opacity-75 backdrop-blur-sm","aria-hidden":"true"}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"‚Äã"}),e.jsxs(I.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2},className:"relative inline-block w-full max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl max-h-[90vh] overflow-y-auto sm:align-middle",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ze,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Gu√≠a de Uso del Sistema de Inventario"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-lg",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"prose prose-sm max-w-none",children:[e.jsxs("section",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:"1. Iniciar la aplicaci√≥n"}),e.jsxs("ul",{className:"space-y-2 text-gray-700",children:[e.jsx("li",{children:"‚Ä¢ Ingresa tus credenciales en la pantalla de login"}),e.jsx("li",{children:"‚Ä¢ Verifica que la tabla est√© vac√≠a al comenzar un nuevo inventario"}),e.jsx("li",{children:"‚Ä¢ El sistema cargar√° autom√°ticamente los datos guardados"})]})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:"2. Buscar y agregar productos"}),e.jsxs("ul",{className:"space-y-2 text-gray-700",children:[e.jsx("li",{children:"‚Ä¢ Utiliza la barra de b√∫squeda para encontrar productos por nombre o c√≥digo"}),e.jsx("li",{children:"‚Ä¢ Las sugerencias aparecer√°n autom√°ticamente mientras escribes"}),e.jsx("li",{children:"‚Ä¢ Selecciona un producto de la lista de sugerencias"}),e.jsx("li",{children:"‚Ä¢ Se abrir√° una ventana para ingresar la cantidad contabilizada"}),e.jsx("li",{children:"‚Ä¢ Ajusta el precio si es necesario (solo para este inventario)"}),e.jsx("li",{children:'‚Ä¢ Haz clic en "Agregar" para incluir el producto en tu inventario'}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Puedes agregar el mismo producto varias veces"})," (√∫til para diferentes √°reas)"]})]})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:"3. Gesti√≥n de la tabla"}),e.jsxs("ul",{className:"space-y-2 text-gray-700",children:[e.jsx("li",{children:"‚Ä¢ Ordena los productos haciendo clic en los encabezados de las columnas"}),e.jsx("li",{children:"‚Ä¢ Usa los controles de paginaci√≥n para navegar entre p√°ginas"}),e.jsx("li",{children:"‚Ä¢ Filtra por categor√≠as usando el selector correspondiente"}),e.jsx("li",{children:"‚Ä¢ Elimina productos individuales usando el bot√≥n de eliminar en cada fila"}),e.jsx("li",{children:"‚Ä¢ El total se actualiza autom√°ticamente con cada cambio"}),e.jsx("li",{children:"‚Ä¢ Los productos duplicados se muestran por separado en la tabla"})]})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:"4. Correcci√≥n de errores"}),e.jsxs("ul",{className:"space-y-2 text-gray-700",children:[e.jsx("li",{children:"‚Ä¢ Para corregir cantidades incorrectas, elimina el producto de la lista"}),e.jsx("li",{children:"‚Ä¢ Busca el producto nuevamente y agregalo con la cantidad correcta"}),e.jsx("li",{children:"‚Ä¢ Los cambios se guardan autom√°ticamente en el navegador"}),e.jsx("li",{children:"‚Ä¢ Si tienes productos duplicados, puedes eliminar solo las entradas incorrectas"})]})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:"5. Finalizar y exportar"}),e.jsxs("ul",{className:"space-y-2 text-gray-700",children:[e.jsx("li",{children:'‚Ä¢ Selecciona "Todo" en el selector de elementos por p√°gina para ver todos los productos'}),e.jsx("li",{children:"‚Ä¢ Revisa que todos los productos est√©n correctos"}),e.jsx("li",{children:'‚Ä¢ Usa el bot√≥n "Exportar" para descargar un archivo CSV con todos los datos'}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Al exportar, los productos duplicados se consolidan autom√°ticamente"})]}),e.jsx("li",{children:"‚Ä¢ El archivo incluir√° las cantidades sumadas de productos repetidos"})]})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:"6. Funciones adicionales"}),e.jsxs("ul",{className:"space-y-2 text-gray-700",children:[e.jsx("li",{children:"‚Ä¢ Usa los botones flotantes en la esquina inferior derecha para:"}),e.jsx("li",{className:"ml-4",children:"- Limpiar todo el inventario"}),e.jsx("li",{className:"ml-4",children:"- Exportar datos r√°pidamente"}),e.jsx("li",{className:"ml-4",children:"- Acceder a esta ayuda"}),e.jsx("li",{className:"ml-4",children:"- Volver al inicio de la p√°gina"}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"üíæ Guardado autom√°tico:"})," Tu progreso se guarda autom√°ticamente cada vez que agregas o quitas productos"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"üîÑ Recuperaci√≥n:"})," Si recargas la p√°gina accidentalmente, tu inventario se restaurar√° autom√°ticamente"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"‚òÅÔ∏è Base de datos:"})," Los datos se almacenan de forma segura en la base de datos"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"üì± Acceso m√∫ltiple:"})," Puedes acceder a tu inventario desde cualquier dispositivo"]})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h5",{className:"font-semibold text-blue-900 mb-2",children:"Consejos importantes:"}),e.jsxs("ul",{className:"text-blue-800 text-sm space-y-1",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"üíæ Los datos se guardan autom√°ticamente en la base de datos"})," cada vez que haces cambios"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"üîÑ Puedes recargar la p√°gina"})," sin perder tu progreso"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"üì± Acceso desde cualquier dispositivo"})," con tu cuenta de usuario"]}),e.jsx("li",{children:"‚Ä¢ Usa la funci√≥n de exportar regularmente para hacer respaldos"}),e.jsx("li",{children:"‚Ä¢ Los cambios de precio en el modal solo afectan el inventario actual"}),e.jsx("li",{children:'‚Ä¢ Para cambios permanentes de precio, toca sobre el boton que se encuentra en la parte superior derecha llamado "Gestion de Productos" busca el producto y edita el Precio'}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Los productos duplicados son √∫tiles para inventarios por √°reas"})]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"La exportaci√≥n consolida autom√°ticamente los duplicados"})]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"‚òÅÔ∏è Cada usuario tiene su propio inventario"})," en la base de datos"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"‚úÖ Puedes completar inventarios"})," y empezar nuevos cuando termines"]})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:t,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:"Entendido"})})]})]})})})},oe=class oe{static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}async sendOTPEmail(t,h,l,r){try{console.log("üìß Iniciando env√≠o de email 2FA..."),console.log("üìß Destinatario:",t),console.log("üéØ Acci√≥n:",l),r&&console.log("üì¶ Producto:",r);const s=this.generateOTPEmailHTML(h,l,r,t),d={to:t,subject:`üîê C√≥digo de Verificaci√≥n 2FA - ${l}`,html:s};console.log("üìß Intentando enviar via Edge Function...");try{const{data:o,error:f}=await F.functions.invoke("send-email",{body:d});if(console.log("üìß Edge Function response:",o),console.log("üìß Edge Function error:",f),!f&&(o!=null&&o.success))return console.log("‚úÖ Email enviado exitosamente via Edge Function"),console.log("üìß Message ID:",o.messageId),!0;console.log("‚ö†Ô∏è Edge Function fall√≥ o no configurado, usando fallback")}catch{console.log("üìß Message ID:",data.messageId),console.log("üîí C√≥digo enviado por email - no mostrado por seguridad"),console.log("üîÑ Usando sistema fallback...")}console.log("üîÑ Activando sistema fallback (modo desarrollo)");const p=`üîê C√ìDIGO DE VERIFICACI√ìN 2FA

üìß Para: ${t}
üéØ Acci√≥n: ${l}
${r?`üì¶ Producto: ${r}
`:""}
üîê Tu c√≥digo de verificaci√≥n es:

    ${h}

‚è∞ V√°lido por: 10 minutos

üí° INFORMACI√ìN DEL SISTEMA:
‚ö†Ô∏è Edge Function no disponible o Resend no configurado
‚úÖ El sistema 2FA funciona correctamente
üîí Para habilitar emails autom√°ticos:
   1. Configura RESEND_API_KEY en Supabase
   2. Despliega la Edge Function correctamente

Ingresa este c√≥digo en la ventana de verificaci√≥n.`;return setTimeout(()=>{alert(p)},100),console.log("‚úÖ C√≥digo mostrado via fallback"),!0}catch(s){console.error("‚ùå Error cr√≠tico en servicio de email:",s);const d=`‚ùå ERROR EN SISTEMA DE EMAIL

üîê Tu c√≥digo de verificaci√≥n es: ${h}

‚ö†Ô∏è Error t√©cnico: ${s.message}

üí° El c√≥digo sigue siendo v√°lido.
Ingresa este c√≥digo para continuar.`;return setTimeout(()=>{alert(d)},100),console.log("‚ö†Ô∏è Error en Edge Function - usando fallback"),!0}}generateOTPEmailHTML(t,h,l,r){return`
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√≥digo de Verificaci√≥n 2FA</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8fafc;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3B82F6, #8B5CF6);
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        .title {
            color: #1f2937;
            font-size: 24px;
            font-weight: bold;
            margin: 0;
        }
        .subtitle {
            color: #6b7280;
            font-size: 16px;
            margin: 8px 0 0 0;
        }
        .alert {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .alert-title {
            color: #dc2626;
            font-weight: bold;
            font-size: 18px;
            margin: 0 0 10px 0;
        }
        .alert-content {
            color: #7f1d1d;
            margin: 0;
        }
        .otp-container {
            text-align: center;
            margin: 30px 0;
            padding: 30px;
            background: linear-gradient(135deg, #eff6ff, #f0f9ff);
            border-radius: 12px;
            border: 2px solid #3b82f6;
        }
        .otp-label {
            color: #1e40af;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }
        .otp-code {
            font-size: 36px;
            font-weight: bold;
            color: #1e40af;
            letter-spacing: 8px;
            font-family: 'Courier New', monospace;
            background: white;
            padding: 15px 30px;
            border-radius: 8px;
            border: 2px solid #3b82f6;
            display: inline-block;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .info-item {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .info-label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        .info-value {
            color: #6b7280;
            font-size: 14px;
            margin-top: 4px;
        }
        .warning {
            background: #fffbeb;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .warning-title {
            color: #92400e;
            font-weight: bold;
            margin: 0 0 10px 0;
        }
        .warning-list {
            color: #78350f;
            margin: 0;
            padding-left: 20px;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            color: #6b7280;
            font-size: 14px;
        }
        .security-badge {
            display: inline-flex;
            align-items: center;
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }
        @media (max-width: 600px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            .otp-code {
                font-size: 28px;
                letter-spacing: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 7L12 3L4 7M20 7L12 11M20 7V17L12 21M12 11L4 7M12 11V21M4 7V17L12 21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h1 class="title">üîê Verificaci√≥n de Seguridad</h1>
            <p class="subtitle">Sistema de Autenticaci√≥n de Doble Factor</p>
        </div>

        <div class="alert">
            <h2 class="alert-title">‚ö†Ô∏è Acci√≥n Cr√≠tica Detectada</h2>
            <p class="alert-content">
                Se ha solicitado realizar una acci√≥n que requiere verificaci√≥n adicional de seguridad.
            </p>
        </div>

        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">üìß Destinatario</div>
                <div class="info-value">${r||"Usuario"}</div>
            </div>
            <div class="info-item">
                <div class="info-label">üéØ Acci√≥n Solicitada</div>
                <div class="info-value">${h}</div>
            </div>
            ${l?`
            <div class="info-item">
                <div class="info-label">üì¶ Producto Afectado</div>
                <div class="info-value">${l}</div>
            </div>
            `:""}
            <div class="info-item">
                <div class="info-label">‚è∞ Generado</div>
                <div class="info-value">${new Date().toLocaleString("es-ES")}</div>
            </div>
        </div>

        <div class="otp-container">
            <div class="otp-label">Tu C√≥digo de Verificaci√≥n</div>
            <div class="otp-code">${t}</div>
            <div class="security-badge">
                üõ°Ô∏è V√°lido por 10 minutos
            </div>
        </div>

        <div class="warning">
            <h3 class="warning-title">üîí Instrucciones de Seguridad</h3>
            <ul class="warning-list">
                <li>Este c√≥digo expira en <strong>10 minutos</strong></li>
                <li>Solo tienes <strong>3 intentos</strong> para ingresarlo correctamente</li>
                <li>Es v√°lido √∫nicamente para la acci√≥n especificada</li>
                <li>Si no solicitaste esta acci√≥n, <strong>ignora este email</strong></li>
                <li><strong>Nunca compartas</strong> este c√≥digo con nadie</li>
            </ul>
        </div>

        <div class="footer">
            <p>
                <strong>Sistema de Inventario v6.0</strong><br>
                Protegido por autenticaci√≥n de doble factor
            </p>
            <p style="margin-top: 20px; font-size: 12px; color: #9ca3af;">
                Si tienes problemas, contacta al administrador del sistema.
            </p>
        </div>
    </div>
</body>
</html>
    `}isEmailServiceConfigured(){return!0}getServiceInfo(){return{configured:!0,provider:"Edge Function + Fallback System"}}};$e(oe,"instance");let ke=oe;const Oe=ke.getInstance(),$t=()=>{const[g,t]=a.useState(!1),[h,l]=a.useState(null),r=()=>Math.floor(1e5+Math.random()*9e5).toString();return{sendOTP:async(b,u,y)=>{t(!0),l(null);try{console.log("üîê Iniciando proceso de verificaci√≥n 2FA...");const w=r(),m=new Date(Date.now()+10*60*1e3),N={email:b,code:w,expiresAt:m,attempts:0,isUsed:!1,action:u,productName:y};if(localStorage.setItem("pending_otp",JSON.stringify(N)),console.log("‚úÖ C√≥digo OTP generado - no mostrado por seguridad"),console.log("üìß Enviando email a:",b),console.log("üéØ Acci√≥n:",u),y&&console.log("üì¶ Producto:",y),await Oe.sendOTPEmail(b,w,u,y))console.log("‚úÖ Email enviado exitosamente via Edge Function"),console.log("üì¨ C√≥digo enviado por email - revisa tu bandeja de entrada");else{console.log("‚ö†Ô∏è Fallback: Edge Function no disponible o Resend no configurado");const S=`üîê C√ìDIGO DE VERIFICACI√ìN (Modo Desarrollo)

üìß Para: ${b}
üéØ Acci√≥n: ${u}
${y?`üì¶ Producto: ${y}
`:""}
üîê Tu c√≥digo de verificaci√≥n es:

    ${w}

‚è∞ V√°lido por: 10 minutos

üí° INFORMACI√ìN DEL SISTEMA:
‚ö†Ô∏è Modo desarrollo: Edge Function no disponible o Resend no configurado
‚úÖ El sistema 2FA funciona correctamente
üîí Para habilitar emails: Configura RESEND_API_KEY en Supabase

Ingresa este c√≥digo en la ventana de verificaci√≥n.`;setTimeout(()=>{alert(S)},100)}return!0}catch(w){return console.error("‚ùå Error en sistema 2FA:",w),l("Error al enviar c√≥digo de verificaci√≥n"),!1}finally{t(!1)}},verifyOTP:async b=>{t(!0),l(null);try{const u=localStorage.getItem("pending_otp");if(!u)return l("No hay c√≥digo de verificaci√≥n pendiente"),!1;const y=JSON.parse(u);return y.isUsed?(l("Este c√≥digo ya fue utilizado"),!1):new Date>new Date(y.expiresAt)?(l("El c√≥digo de verificaci√≥n ha expirado"),localStorage.removeItem("pending_otp"),!1):(y.attempts+=1,y.attempts>3?(l("Demasiados intentos fallidos. Solicita un nuevo c√≥digo."),localStorage.removeItem("pending_otp"),!1):b.trim()!==y.code?(localStorage.setItem("pending_otp",JSON.stringify(y)),l(`C√≥digo incorrecto. Intentos restantes: ${4-y.attempts}`),!1):(y.isUsed=!0,localStorage.setItem("pending_otp",JSON.stringify(y)),console.log("‚úÖ C√≥digo verificado exitosamente"),console.log("üîí Acci√≥n autorizada:",y.action),y.productName&&console.log("üì¶ Producto autorizado:",y.productName),setTimeout(()=>{localStorage.removeItem("pending_otp")},6e4),!0))}catch(u){return console.error("‚ùå Error verificando c√≥digo OTP:",u),l("Error al verificar el c√≥digo"),!1}finally{t(!1)}},clearPendingOTP:()=>{localStorage.removeItem("pending_otp"),l(null)},hasPendingOTP:()=>{const b=localStorage.getItem("pending_otp");if(!b)return!1;try{const u=JSON.parse(b);return!u.isUsed&&new Date<=new Date(u.expiresAt)}catch{return!1}},getPendingOTPInfo:()=>{const b=localStorage.getItem("pending_otp");if(!b)return null;try{const u=JSON.parse(b);if(!u.isUsed&&new Date<=new Date(u.expiresAt))return u}catch{return null}return null},getEmailServiceInfo:()=>Oe.getServiceInfo(),isLoading:g,error:h}},Lt=({isOpen:g,onClose:t,onVerified:h,email:l,action:r,productName:s,description:d})=>{const[p,o]=a.useState("send"),[f,c]=a.useState(["","","","","",""]),[b,u]=a.useState(600),[y,w]=a.useState(!1),m=a.useRef([]),{sendOTP:N,verifyOTP:E,clearPendingOTP:S,hasPendingOTP:T,getEmailServiceInfo:j,isLoading:x,error:C}=$t(),P=j();a.useEffect(()=>{if(p==="verify"&&b>0){const i=setInterval(()=>{u(v=>v<=1?(w(!0),0):v-1)},1e3);return()=>clearInterval(i)}},[p,b]),a.useEffect(()=>{var i;p==="verify"&&m.current[0]&&((i=m.current[0])==null||i.focus())},[p]),a.useEffect(()=>{g&&T()&&(o("verify"),u(600))},[g,T]);const $=i=>{const v=Math.floor(i/60),A=i%60;return`${v}:${A.toString().padStart(2,"0")}`},L=async()=>{await N(l,r,s)&&(o("verify"),u(600),w(!1))},V=(i,v)=>{var q;if(v.length>1||!/^\d*$/.test(v))return;const A=[...f];A[i]=v,c(A),v&&i<5&&((q=m.current[i+1])==null||q.focus()),A.every(H=>H!=="")&&A.join("").length===6&&G(A.join(""))},M=(i,v)=>{var A;v.key==="Backspace"&&!f[i]&&i>0&&((A=m.current[i-1])==null||A.focus())},G=async i=>{const v=i||f.join("");if(v.length!==6)return;await E(v)&&(h(),R())},U=async()=>{S(),c(["","","","","",""]),u(600),w(!1),await L()},R=()=>{o("send"),c(["","","","","",""]),u(600),w(!1),S(),t()},n=i=>{i.target===i.currentTarget&&R()};return e.jsx(Q,{children:g&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",onClick:n,children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gray-500 bg-opacity-75 backdrop-blur-sm","aria-hidden":"true"}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"‚Äã"}),e.jsxs(I.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2},className:"relative inline-block w-full max-w-md p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl sm:align-middle",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(me,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Verificaci√≥n de Seguridad"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Autenticaci√≥n de doble factor requerida"})]})]}),e.jsx("button",{onClick:R,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-lg",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Se,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-red-900 mb-1",children:["Acci√≥n Cr√≠tica: ",r]}),s&&e.jsxs("p",{className:"text-sm text-red-800 mb-2",children:[e.jsx("strong",{children:"Producto:"})," ",s]}),d&&e.jsx("p",{className:"text-sm text-red-700",children:d})]})]})}),p==="send"&&e.jsxs(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(we,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Verificaci√≥n por Email"}),P.configured?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(qe,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Sistema 2FA Robusto"})]}),e.jsxs("p",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"‚úÖ Sistema H√≠brido:"})," Intenta email autom√°tico, fallback garantizado."]}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["üìß Proveedor: ",P.provider," | üîí Siempre funcional"]})]}):e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(xt,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Modo Desarrollo"})]}),e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"‚ö†Ô∏è Email no configurado:"})," El c√≥digo aparecer√° en una alerta."]}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"üîß Para habilitar email: Configura VITE_RESEND_API_KEY"})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:P.configured?"Se intentar√° enviar por email, o aparecer√° en una alerta si hay problemas.":"Se generar√° un c√≥digo de verificaci√≥n de 6 d√≠gitos."}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Email:"})," ",l]})})]}),e.jsx("button",{onClick:L,disabled:x,className:"w-full flex items-center justify-center px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 animate-spin mr-2"}),"Enviando c√≥digo..."]}):e.jsx(e.Fragment,{children:P.configured?e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Generar C√≥digo de Verificaci√≥n"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Generar C√≥digo de Verificaci√≥n"]})})}),P.configured?e.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-green-700",children:["‚úÖ ",e.jsx("strong",{children:"Sistema Robusto:"})," Intenta email autom√°tico con fallback.",e.jsx("br",{}),"üîí ",e.jsx("strong",{children:"Siempre Funcional:"})," El c√≥digo aparecer√° de una u otra forma."]})}):e.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["‚úÖ ",e.jsx("strong",{children:"Sistema 2FA Operativo:"})," Protecci√≥n de seguridad activa.",e.jsx("br",{}),"üîí ",e.jsx("strong",{children:"Funcional:"})," El c√≥digo se genera y verifica correctamente."]})})]}),p==="verify"&&e.jsxs(I.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Ingresa el C√≥digo de Verificaci√≥n"}),P.configured?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4",children:[e.jsxs("p",{className:"text-sm text-green-800",children:["‚úÖ ",e.jsx("strong",{children:"C√≥digo generado exitosamente"})]}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["üìß Para: ",e.jsx("strong",{children:l})," | üéØ Acci√≥n: ",e.jsx("strong",{children:r})]}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"üì¨ Revisa tu bandeja de entrada (y carpeta de spam)"})]}):e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:["‚úÖ ",e.jsx("strong",{children:"C√≥digo generado exitosamente"})]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["üìß Para: ",e.jsx("strong",{children:l})," | üéØ Acci√≥n: ",e.jsx("strong",{children:r})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"üí° El c√≥digo apareci√≥ en una alerta emergente"})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:P.configured?"Ingresa el c√≥digo de 6 d√≠gitos (email o alerta):":"Ingresa el c√≥digo de 6 d√≠gitos de la alerta:"})]}),e.jsx("div",{className:"flex justify-center space-x-2 mb-4",children:f.map((i,v)=>e.jsx("input",{ref:A=>m.current[v]=A,type:"text",maxLength:1,value:i,onChange:A=>V(v,A.target.value),onKeyDown:A=>M(v,A),className:"w-12 h-12 text-center text-lg font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition-colors",placeholder:"0"},v))}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-600",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:b>0?e.jsxs(e.Fragment,{children:["C√≥digo v√°lido por: ",e.jsx("strong",{children:$(b)})]}):e.jsx("span",{className:"text-red-600",children:"C√≥digo expirado"})})]})}),e.jsx("button",{onClick:()=>G(),disabled:x||f.some(i=>i==="")||b===0,className:"w-full flex items-center justify-center px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 animate-spin mr-2"}),"Verificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Verificar C√≥digo"]})}),(y||b===0)&&e.jsxs("button",{onClick:U,disabled:x,className:"w-full flex items-center justify-center px-4 py-2 text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors duration-200",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Reenviar C√≥digo"]})]}),C&&e.jsx(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Se,{className:"w-4 h-4 text-red-600"}),e.jsx("p",{className:"text-sm text-red-600",children:C})]})}),e.jsx("div",{className:"mt-6 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(me,{className:"w-4 h-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"üîí Sistema de Seguridad 2FA"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"‚Ä¢ El c√≥digo expira en 10 minutos"}),e.jsx("li",{children:"‚Ä¢ M√°ximo 3 intentos por c√≥digo"}),e.jsx("li",{children:"‚Ä¢ Solo v√°lido para esta acci√≥n espec√≠fica"}),e.jsx("li",{children:"‚Ä¢ Protege contra eliminaciones accidentales"}),e.jsx("li",{children:"‚Ä¢ ‚úÖ Sistema robusto con fallback garantizado"})]})]})]})})]})]})})})},_t=({onAddToInventory:g,onBackToInventory:t})=>{const[h,l]=a.useState([]),[r,s]=a.useState(!0),[d,p]=a.useState(""),[o,f]=a.useState(null),[c,b]=a.useState(!1),[u,y]=a.useState(!1),[w,m]=a.useState(1),[N,E]=a.useState(20),[S,T]=a.useState(0),[j,x]=a.useState(0),[C,P]=a.useState(null),[$,L]=a.useState(null),[V,M]=a.useState(!1),[G,U]=a.useState(!1),{user:R}=se(),n=async(k=1,_="")=>{s(!0),U(!0);try{const O=(k-1)*N,ae=O+N-1;let de=F.from("productos").select("*",{count:"exact"}).range(O,ae).order("Producto");_.trim()&&(de=de.or(`Producto.ilike.%${_}%,Codigo.ilike.%${_}%,Codigo1.ilike.%${_}%,Codigo2.ilike.%${_}%,Codigo3.ilike.%${_}%,Codigo4.ilike.%${_}%`));const{data:ne,error:ge,count:ue}=await de;if(ge)throw ge;l(ne||[]),T(ue||0),x(Math.ceil((ue||0)/N)),console.log(`üìä Cargados ${(ne==null?void 0:ne.length)||0} productos de ${ue||0} total`)}catch(O){console.error("Error loading products:",O),v("error","Error al cargar productos")}finally{s(!1),U(!1)}},i=async k=>{try{const{data:_,error:O}=await F.from("productos").select("*").or(`id.eq.${k},Codigo.eq.${k},Codigo1.eq.${k},Codigo2.eq.${k},Codigo3.eq.${k},Codigo4.eq.${k},Producto.ilike.%${k}%`).limit(1);if(O)throw O;return _&&_.length>0?_[0]:null}catch(_){return console.error("Error searching specific product:",_),null}};a.useEffect(()=>{n(1,"")},[]),a.useEffect(()=>{const k=setTimeout(()=>{m(1),n(1,d)},500);return()=>clearTimeout(k)},[d,N]),a.useEffect(()=>{w>1&&n(w,d)},[w]);const v=(k,_)=>{P({type:k,message:_}),setTimeout(()=>P(null),3e3)},A=k=>{f(k),b(!0)},q=async()=>{if(!d.trim()){v("error","Ingresa un t√©rmino de b√∫squeda");return}U(!0);const k=await i(d);U(!1),k?(f(k),b(!0),v("success",`Producto encontrado: ${k.Producto}`)):v("error","No se encontr√≥ ning√∫n producto con ese criterio")},H=async k=>{const _=h.find(O=>O.id===k);_&&(L(_),M(!0))},ee=async()=>{if($)try{const{error:k}=await F.from("productos").delete().eq("id",$.id);if(k)throw k;await n(w,d),v("success",`Producto "${$.Producto}" eliminado correctamente con verificaci√≥n 2FA`)}catch(k){console.error("Error deleting product:",k),v("error","Error al eliminar producto")}finally{L(null),M(!1)}},B=k=>{k>=1&&k<=j&&m(k)},W=k=>{E(k),m(1)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx(Te,{currentView:"products",onViewChange:t?()=>t():void 0}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:t&&e.jsxs("button",{onClick:t,className:"inline-flex items-center px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Volver al Inventario"]})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gesti√≥n de Productos"}),e.jsx("p",{className:"text-gray-600",children:"Administra tu cat√°logo de productos"})]}),e.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:d,onChange:k=>p(k.target.value),placeholder:"Buscar por ID, nombre, c√≥digo... (b√∫squeda en tiempo real)",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),G&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(J,{className:"w-4 h-4 animate-spin text-blue-600"})})]}),e.jsx("button",{onClick:q,disabled:G||!d.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:G?e.jsx(J,{className:"w-4 h-4 animate-spin"}):"Buscar y Editar"}),e.jsxs("select",{value:N,onChange:k=>W(Number(k.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:10,children:"10 por p√°gina"}),e.jsx("option",{value:20,children:"20 por p√°gina"}),e.jsx("option",{value:50,children:"50 por p√°gina"}),e.jsx("option",{value:100,children:"100 por p√°gina"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",h.length," de ",S.toLocaleString()," productos",d&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs",children:['Filtrado: "',d,'"']})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["P√°gina ",w," de ",j]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(he,{className:"w-4 h-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"üí° Consejos de b√∫squeda:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"B√∫squeda autom√°tica:"})," Escribe y espera 0.5 segundos"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Buscar y editar:"})," Usa el bot√≥n verde para encontrar productos espec√≠ficos"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Busca por:"})," ID, nombre, c√≥digo principal o c√≥digos alternativos"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Paginaci√≥n:"})," Navega entre ",j," p√°ginas de productos"]})]})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:r?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(J,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsxs("span",{className:"ml-3 text-gray-600",children:["Cargando productos (p√°gina ",w,")..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"C√≥digo Principal"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"C√≥digos Alt."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.jsx(Q,{children:h.map((k,_)=>e.jsxs(I.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:_*.05},className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-8 h-8 text-gray-400 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:k.Producto}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",k.id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-mono text-gray-900",children:k.Codigo})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[[k.Codigo1,k.Codigo2,k.Codigo3,k.Codigo4].filter(O=>O&&O.trim()!==""&&O!=="NULL").map((O,ae)=>e.jsx("div",{className:"font-mono text-xs text-gray-600 mb-1",children:O},ae)),[k.Codigo1,k.Codigo2,k.Codigo3,k.Codigo4].filter(O=>O&&O.trim()!==""&&O!=="NULL").length===0&&e.jsx("span",{className:"text-xs text-gray-400 italic",children:"Sin c√≥digos alternativos"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-semibold text-green-600",children:["$",k.Precio.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[g&&e.jsx("button",{onClick:()=>{const O={id:k.id.toString(),name:k.Producto,code:k.Codigo,code1:k.Codigo1,code2:k.Codigo2,code3:k.Codigo3,code4:k.Codigo4,price:k.Precio,category:"Producto"};g(O,1),v("success","Producto agregado al inventario")},className:"text-green-600 hover:text-green-900 p-1 hover:bg-green-50 rounded",title:"Agregar al inventario",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(k),className:"text-blue-600 hover:text-blue-900 p-1 hover:bg-blue-50 rounded transition-colors",title:"Editar producto",children:e.jsx(pt,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>H(k.id),className:"text-red-600 hover:text-red-900 p-1 hover:bg-red-50 rounded transition-colors relative group",title:"Eliminar producto",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"absolute -top-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:"üîí Requiere 2FA (Testing)"})]})]})})]},k.id))})})]})}),j>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",(w-1)*N+1," a"," ",Math.min(w*N,S)," de"," ",S.toLocaleString()," productos"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>B(1),disabled:w===1,className:"px-2 py-1 text-xs border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Primera"}),e.jsx("button",{onClick:()=>B(w-10),disabled:w<=10,className:"px-2 py-1 text-xs border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"-10"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>B(w-1),disabled:w===1,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["P√°gina ",w," de ",j]}),e.jsx("button",{onClick:()=>B(w+1),disabled:w===j,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Siguiente"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>B(w+10),disabled:w+10>j,className:"px-2 py-1 text-xs border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"+10"}),e.jsx("button",{onClick:()=>B(j),disabled:w===j,className:"px-2 py-1 text-xs border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"√öltima"})]})]})]})})]})}),e.jsx(Ft,{isOpen:c,onClose:()=>b(!1),product:o,onSave:()=>n(w,d),onNotification:v}),e.jsx(Ot,{isOpen:u,onClose:()=>y(!1),onSave:()=>n(w,d),onNotification:v,onAddToInventory:g}),e.jsx(Lt,{isOpen:V,onClose:()=>{M(!1),L(null)},onVerified:ee,email:(R==null?void 0:R.username)||"",action:"Eliminar Producto",productName:$==null?void 0:$.Producto,description:"Esta acci√≥n eliminar√° permanentemente el producto de la base de datos. Esta operaci√≥n no se puede deshacer."}),e.jsx(Q,{children:C&&e.jsx(I.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:`fixed bottom-4 right-4 z-50 p-4 rounded-lg shadow-lg ${C.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[C.type==="success"?e.jsx(te,{className:"w-5 h-5"}):e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{children:C.message})]})})})]})]})},Ft=({isOpen:g,onClose:t,product:h,onSave:l,onNotification:r})=>{const[s,d]=a.useState({}),[p,o]=a.useState(!1);a.useEffect(()=>{h&&d(h)},[h]);const f=async()=>{if(!h||!s.Producto||!s.Codigo||!s.Precio){r("error","Por favor completa todos los campos requeridos");return}o(!0);try{const{error:c}=await F.from("productos").update({Producto:s.Producto,Codigo:s.Codigo,Codigo1:s.Codigo1||null,Codigo2:s.Codigo2||null,Codigo3:s.Codigo3||null,Codigo4:s.Codigo4||null,Precio:s.Precio}).eq("id",h.id);if(c)throw c;r("success","Producto actualizado correctamente"),l(),t()}catch(c){console.error("Error updating product:",c),r("error","Error al actualizar producto")}finally{o(!1)}};return!g||!h?null:e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 backdrop-blur-sm",onClick:t}),e.jsxs("div",{className:"relative inline-block w-full max-w-2xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl sm:align-middle",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Editar Producto"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Producto *"}),e.jsx("input",{type:"text",value:s.Producto||"",onChange:c=>d({...s,Producto:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Principal *"}),e.jsx("input",{type:"text",value:s.Codigo||"",onChange:c=>d({...s,Codigo:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio *"}),e.jsx("input",{type:"number",step:"0.01",value:s.Precio||"",onChange:c=>d({...s,Precio:parseFloat(c.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Alternativo 1"}),e.jsx("input",{type:"text",value:s.Codigo1||"",onChange:c=>d({...s,Codigo1:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Alternativo 2"}),e.jsx("input",{type:"text",value:s.Codigo2||"",onChange:c=>d({...s,Codigo2:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Alternativo 3"}),e.jsx("input",{type:"text",value:s.Codigo3||"",onChange:c=>d({...s,Codigo3:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Alternativo 4"}),e.jsx("input",{type:"text",value:s.Codigo4||"",onChange:c=>d({...s,Codigo4:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-6",children:[e.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200",children:"Cancelar"}),e.jsx("button",{onClick:f,disabled:p,className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 disabled:opacity-50",children:p?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(J,{className:"w-4 h-4 animate-spin mr-2"}),"Guardando..."]}):e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})})]})]})]})})},Ot=({isOpen:g,onClose:t,onSave:h,onNotification:l,onAddToInventory:r})=>{const[s,d]=a.useState({Producto:"",Codigo:"",Codigo1:"",Codigo2:"",Codigo3:"",Codigo4:"",Precio:0,quantity:1}),[p,o]=a.useState(!1),f=async()=>{if(!s.Producto||!s.Codigo||!s.Precio){l("error","Por favor completa todos los campos requeridos");return}o(!0);try{const{data:c,error:b}=await F.from("productos").insert({Producto:s.Producto,Codigo:s.Codigo,Codigo1:s.Codigo1||null,Codigo2:s.Codigo2||null,Codigo3:s.Codigo3||null,Codigo4:s.Codigo4||null,Precio:s.Precio}).select().single();if(b)throw b;if(l("success","Producto creado correctamente"),r&&c){const u={id:c.id.toString(),name:c.Producto,code:c.Codigo,code1:c.Codigo1,code2:c.Codigo2,code3:c.Codigo3,code4:c.Codigo4,price:c.Precio,category:"Producto"};r(u,s.quantity),l("success",`Producto agregado al inventario con cantidad ${s.quantity}`)}h(),t(),d({Producto:"",Codigo:"",Codigo1:"",Codigo2:"",Codigo3:"",Codigo4:"",Precio:0,quantity:1})}catch(c){console.error("Error creating product:",c),l("error","Error al crear producto")}finally{o(!1)}};return g?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 backdrop-blur-sm",onClick:t}),e.jsxs("div",{className:"relative inline-block w-full max-w-2xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl sm:align-middle",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Crear Nuevo Producto"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Producto *"}),e.jsx("input",{type:"text",value:s.Producto,onChange:c=>d({...s,Producto:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Coca Cola 2L",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Principal *"}),e.jsx("input",{type:"text",value:s.Codigo,onChange:c=>d({...s,Codigo:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ej: 7791234567890",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio *"}),e.jsx("input",{type:"number",step:"0.01",value:s.Precio,onChange:c=>d({...s,Precio:parseFloat(c.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Alternativo 1"}),e.jsx("input",{type:"text",value:s.Codigo1,onChange:c=>d({...s,Codigo1:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Opcional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Alternativo 2"}),e.jsx("input",{type:"text",value:s.Codigo2,onChange:c=>d({...s,Codigo2:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Opcional"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Alternativo 3"}),e.jsx("input",{type:"text",value:s.Codigo3,onChange:c=>d({...s,Codigo3:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Opcional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo Alternativo 4"}),e.jsx("input",{type:"text",value:s.Codigo4,onChange:c=>d({...s,Codigo4:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Opcional"})]})]}),r&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-blue-900 mb-1",children:"Cantidad para Inventario"}),e.jsx("input",{type:"number",min:"1",value:s.quantity,onChange:c=>d({...s,quantity:parseInt(c.target.value)||1}),className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Este producto se agregar√° autom√°ticamente al inventario con esta cantidad"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-6",children:[e.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200",children:"Cancelar"}),e.jsx("button",{onClick:f,disabled:p,className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 disabled:opacity-50",children:p?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(J,{className:"w-4 h-4 animate-spin mr-2"}),"Creando..."]}):e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),r?"Crear y Agregar al Inventario":"Crear Producto"]})})]})]})]})}):null},Mt=({selectedInventoryIds:g,inventories:t,onClose:h})=>{const[l,r]=a.useState([]),[s,d]=a.useState(!0),[p,o]=a.useState("products"),f=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"];a.useEffect(()=>{(async()=>{const N=g.map((E,S)=>{const T=t.find(C=>C.id===E);if(!T)return null;let j=T.total_productos||0,x=T.total_valor||0;return j===0&&x===0&&(j=T.total_productos||0,x=T.total_valor||0),{id:T.id,name:T.nombre,date:new Date(T.created_at).toLocaleDateString(),totalProducts:j,totalValue:x,color:f[S%f.length]}}).filter(Boolean);r(N),d(!1)})()},[g,t]);const c=Math.max(...l.map(m=>p==="products"?m.totalProducts:m.totalValue)),b=m=>m/c*100,y=(()=>{if(l.length<2)return null;const m=[...l].sort((T,j)=>new Date(T.date).getTime()-new Date(j.date).getTime()),N=p==="products"?m[0].totalProducts:m[0].totalValue,E=p==="products"?m[m.length-1].totalProducts:m[m.length-1].totalValue,S=(E-N)/N*100;return{percentage:Math.abs(S),isPositive:S>0,firstValue:N,lastValue:E}})(),w=()=>{const m=["Inventario","Fecha","Total Productos","Valor Total"],N=l.map(C=>[C.name,C.date,C.totalProducts,`$${C.totalValue.toFixed(2)}`]),E=[["","","",""],["COMPARACI√ìN DE INVENTARIOS","","",""],["","","",""],["Inventarios comparados:",l.length,"",""],["Fecha de comparaci√≥n:",new Date().toLocaleDateString(),"",""]];y&&E.push(["","","",""],["AN√ÅLISIS DE TENDENCIA","","",""],["","","",""],[`Cambio en ${p==="products"?"productos":"valor"}:`,`${y.isPositive?"+":"-"}${y.percentage.toFixed(1)}%`,"",""],["Valor inicial:",p==="products"?y.firstValue:`$${y.firstValue.toFixed(2)}`,"",""],["Valor final:",p==="products"?y.lastValue:`$${y.lastValue.toFixed(2)}`,"",""]);const S=[m.join(","),...N.map(C=>C.join(",")),...E.map(C=>C.join(","))].join(`
`),T=new Blob([S],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a"),x=URL.createObjectURL(T);j.setAttribute("href",x),j.setAttribute("download",`comparacion_inventarios_${new Date().toISOString().split("T")[0]}.csv`),j.style.visibility="hidden",document.body.appendChild(j),j.click(),document.body.removeChild(j)};return s?e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(J,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Preparando comparaci√≥n..."})]})}):e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(be,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Comparaci√≥n de Inventarios"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>o("products"),className:`px-3 py-1 text-sm rounded-md transition-colors ${p==="products"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(K,{className:"w-4 h-4 inline mr-1"}),"Productos"]}),e.jsxs("button",{onClick:()=>o("value"),className:`px-3 py-1 text-sm rounded-md transition-colors ${p==="value"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(ie,{className:"w-4 h-4 inline mr-1"}),"Valor"]})]}),e.jsxs("button",{onClick:w,className:"inline-flex items-center px-3 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"Exportar"]}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:e.jsx(X,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"p-6",children:[y&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[y.isPositive?e.jsx(Be,{className:"w-6 h-6 text-green-600"}):e.jsx(ht,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"An√°lisis de Tendencia"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[p==="products"?"Cantidad de productos":"Valor total"," entre el primer y √∫ltimo inventario"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-2xl font-bold ${y.isPositive?"text-green-600":"text-red-600"}`,children:[y.isPositive?"+":"-",y.percentage.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:p==="products"?`${y.firstValue} ‚Üí ${y.lastValue}`:`$${y.firstValue.toFixed(2)} ‚Üí $${y.lastValue.toFixed(2)}`})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-end justify-center space-x-4 h-64 bg-gray-50 rounded-lg p-4",children:l.map((m,N)=>e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:p==="products"?m.totalProducts:`$${m.totalValue.toFixed(0)}`}),e.jsx(I.div,{initial:{height:0},animate:{height:`${b(p==="products"?m.totalProducts:m.totalValue)}%`},transition:{delay:N*.1,duration:.5},className:"w-16 rounded-t-lg flex items-end justify-center",style:{backgroundColor:m.color,minHeight:"20px"},children:e.jsx("div",{className:"text-white text-xs font-medium mb-2",children:N+1})}),e.jsxs("div",{className:"text-xs text-center max-w-20",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:m.name}),e.jsx("div",{className:"text-gray-500",children:m.date})]})]},m.id))})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Inventario"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Productos"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Diferencia"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map((m,N)=>{const E=N>0?l[N-1]:null,S=E?m.totalProducts-E.totalProducts:0,T=E?m.totalValue-E.totalValue:0;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-3",style:{backgroundColor:m.color}}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:m.name})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:m.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:m.totalProducts}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",m.totalValue.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:N===0?e.jsx("span",{className:"text-gray-400",children:"Base"}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:`${S>=0?"text-green-600":"text-red-600"}`,children:[S>=0?"+":"",S," productos"]}),e.jsxs("div",{className:`${T>=0?"text-green-600":"text-red-600"}`,children:[T>=0?"+":"","$",T.toFixed(2)]})]})})]},m.id)})})]})}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Promedio Productos"}),e.jsx("div",{className:"text-lg font-bold text-blue-900",children:Math.round(l.reduce((m,N)=>m+N.totalProducts,0)/l.length)})]})]})}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"w-5 h-5 text-green-600 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Promedio Valor"}),e.jsxs("div",{className:"text-lg font-bold text-green-900",children:["$",(l.reduce((m,N)=>m+N.totalValue,0)/l.length).toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-5 h-5 text-purple-600 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Inventarios"}),e.jsxs("div",{className:"text-lg font-bold text-purple-900",children:[l.length," comparados"]})]})]})})]})]})]})},qt=({onBackToInventory:g})=>{const[t,h]=a.useState([]),[l,r]=a.useState([]),[s,d]=a.useState(!0),[p,o]=a.useState([]),[f,c]=a.useState("all"),[b,u]=a.useState("fecha"),[y,w]=a.useState("desc"),[m,N]=a.useState(!1),[E,S]=a.useState(null),[T,j]=a.useState([]),[x,C]=a.useState(!1),{user:P}=se(),$=async()=>{if(P!=null&&P.id){d(!0);try{const{data:n,error:i}=await F.from("inventarios").select("*").eq("usuario_id",P.id).order("created_at",{ascending:!1});if(i)throw i;h(n||[]),r(n||[]),console.log("üìä Inventarios cargados:",(n==null?void 0:n.length)||0)}catch(n){console.error("Error loading inventory history:",n)}finally{d(!1)}}},L=async n=>{C(!0);try{console.log("üì¶ Cargando detalles del inventario:",n);const{data:i,error:v}=await F.from("inventarios").select("items_data, nombre, descripcion").eq("id",n).single();if(!v&&(i!=null&&i.items_data)){console.log("‚úÖ Cargando desde estructura JSON");const ee=(i.items_data||[]).map(B=>({id:B.id,cantidad_contada:B.quantity,precio_unitario:B.product.price,subtotal:B.subtotal,created_at:B.scannedAt,productos:{id:B.product.id,Producto:B.product.name,Codigo:B.product.code,Precio:B.product.price}}));j(ee),console.log("‚úÖ Detalles cargados desde JSON:",ee.length,"items");return}console.log("üîÑ Fallback: Cargando desde estructura antigua");const{data:A,error:q}=await F.from("items_inventario").select(`
          *,
          productos (
            id,
            Producto,
            Codigo,
            Precio
          )
        `).eq("inventario_id",n);if(q)throw q;j(A||[]),console.log("‚úÖ Detalles cargados desde estructura antigua:",(A==null?void 0:A.length)||0,"items")}catch(i){console.error("Error loading inventory details:",i),j([])}finally{C(!1)}};a.useEffect(()=>{$()},[P==null?void 0:P.id]),a.useEffect(()=>{let n=[...t];f!=="all"&&(n=n.filter(i=>i.estado===f)),n.sort((i,v)=>{let A,q;switch(b){case"fecha":A=new Date(i.created_at),q=new Date(v.created_at);break;case"valor":A=i.total_valor,q=v.total_valor;break;case"productos":A=i.total_productos,q=v.total_productos;break;default:A=new Date(i.created_at),q=new Date(v.created_at)}return y==="asc"?A>q?1:-1:A<q?1:-1}),r(n)},[t,f,b,y]);const V=n=>{o(i=>{if(console.log("üîÑ Estado anterior:",i),console.log("üéØ Intentando seleccionar:",n),i.includes(n)){const v=i.filter(A=>A!==n);return console.log("‚ùå Deseleccionando. Nuevo estado:",v),v}else if(i.length<5){const v=[...i,n];return console.log("‚úÖ Agregando. Nuevo estado:",v),v}else return console.log("‚ö†Ô∏è M√°ximo de inventarios alcanzado (5)"),i})},M=async n=>{S(n),await L(n)},G=n=>{if(T.length===0){alert("No hay detalles para exportar. Primero carga los detalles del inventario.");return}const i=new Map;T.forEach(_=>{const O=_.productos.Codigo;if(i.has(O)){const ae=i.get(O);ae.totalQuantity+=_.cantidad_contada,ae.totalSubtotal+=parseFloat(_.subtotal.toString())}else i.set(O,{producto:_.productos,totalQuantity:_.cantidad_contada,totalSubtotal:parseFloat(_.subtotal.toString()),precio:parseFloat(_.precio_unitario.toString())})});const v=["#","C√≥digo","Producto","Cantidad","Precio Unit.","Subtotal"],A=Array.from(i.values()).map((_,O)=>[O+1,_.producto.Codigo,_.producto.Producto,_.totalQuantity,`$${_.precio.toFixed(2)}`,`$${_.totalSubtotal.toFixed(2)}`]),q=Array.from(i.values()).reduce((_,O)=>_+O.totalQuantity,0);Array.from(i.values()).reduce((_,O)=>_+O.totalSubtotal,0);const H=[["","","","","",""],["","","RESUMEN DEL INVENTARIO","","",""],["","","","","",""],["","","Nombre:",n.nombre,"",""],["","","Fecha:",new Date(n.created_at).toLocaleDateString(),"",""],["","","Estado:",n.estado,"",""],["","","Total productos:",n.total_productos,"",""],["","","Total items contados:",q,"",""],["","","Valor total:","","",`$${n.total_valor.toFixed(2)}`],["","","Productos √∫nicos:",i.size,"",""],["","","Usuario:",(P==null?void 0:P.username)||"Usuario","",""]],ee=[v.join(","),...A.map(_=>_.join(",")),...H.map(_=>_.join(","))].join(`
`),B=new Blob([ee],{type:"text/csv;charset=utf-8;"}),W=document.createElement("a"),k=URL.createObjectURL(B);W.setAttribute("href",k),W.setAttribute("download",`inventario_${n.nombre.replace(/\s+/g,"_")}_${new Date(n.created_at).toISOString().split("T")[0]}.csv`),W.style.visibility="hidden",document.body.appendChild(W),W.click(),document.body.removeChild(W)},U=n=>{switch(n){case"completado":return"bg-green-100 text-green-800";case"en_progreso":return"bg-blue-100 text-blue-800";case"cancelado":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},R=n=>{switch(n){case"completado":return e.jsx(K,{className:"w-4 h-4"});case"en_progreso":return e.jsx(Z,{className:"w-4 h-4"});case"cancelado":return e.jsx(fe,{className:"w-4 h-4"});default:return e.jsx(ft,{className:"w-4 h-4"})}};return s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(J,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Cargando historial"}),e.jsx("p",{className:"text-gray-600",children:"Obteniendo tus inventarios anteriores..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx(Te,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsxs("button",{onClick:g,className:"inline-flex items-center px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Volver al Inventario"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Historial de Inventarios"}),e.jsx("p",{className:"text-gray-600",children:"Consulta y compara tus inventarios anteriores"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>N(!m),disabled:p.length<2,className:`inline-flex items-center px-4 py-2 rounded-lg transition-colors ${p.length>=2?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Comparar (",p.length,")"]}),e.jsxs("button",{onClick:$,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]})]})]}),e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filtrar por estado"}),e.jsxs("select",{value:f,onChange:n=>c(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"completado",children:"Completados"}),e.jsx("option",{value:"en_progreso",children:"En progreso"}),e.jsx("option",{value:"cancelado",children:"Cancelados"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ordenar por"}),e.jsxs("select",{value:b,onChange:n=>u(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"fecha",children:"Fecha"}),e.jsx("option",{value:"valor",children:"Valor total"}),e.jsx("option",{value:"productos",children:"Cantidad de productos"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Orden"}),e.jsxs("select",{value:y,onChange:n=>w(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"desc",children:"Descendente"}),e.jsx("option",{value:"asc",children:"Ascendente"})]})]})]}),p.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-purple-50 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-purple-800",children:[e.jsx("strong",{children:p.length})," inventario",p.length!==1?"s":""," seleccionado",p.length!==1?"s":""," para comparaci√≥n",p.length>=2&&' Haz clic en "Comparar" para ver las gr√°ficas.',p.length>=5&&" (M√°ximo 5 inventarios)"]}),e.jsxs("div",{className:"mt-1 text-xs text-purple-600",children:["IDs seleccionados: ",p.join(", ")]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:p.map(n=>{const i=t.find(v=>v.id===n);return i?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full",children:[i.nombre,e.jsx("button",{onClick:()=>V(n),className:"ml-1 text-purple-600 hover:text-purple-800",children:"√ó"})]},n):null})})]})]}),e.jsx(Q,{children:m&&p.length>=2&&e.jsx(I.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-8",children:e.jsx(Mt,{selectedInventoryIds:p,inventories:t,onClose:()=>N(!1)})})}),e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Inventarios (",l.length,")"]})}),l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay inventarios"}),e.jsx("p",{className:"text-gray-500",children:f==="all"?"A√∫n no has creado ning√∫n inventario":`No hay inventarios con estado "${f}"`})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:l.map((n,i)=>e.jsx(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.05},className:`p-6 hover:bg-gray-50 transition-colors ${p.includes(n.id)?"bg-purple-50":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"checkbox",checked:p.includes(n.id),onChange:v=>{v.stopPropagation(),console.log("üìã Checkbox clicked:",n.id,"Checked:",v.target.checked),V(n.id)},disabled:!p.includes(n.id)&&p.length>=5,className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500 cursor-pointer"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("button",{onClick:()=>{console.log("üìã Label clicked:",n.id),V(n.id)},className:"cursor-pointer text-left",children:e.jsx("h4",{className:"text-lg font-semibold text-gray-900 hover:text-purple-600 transition-colors",children:n.nombre})}),e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${U(n.estado)}`,children:[R(n.estado),e.jsx("span",{className:"ml-1 capitalize",children:n.estado.replace("_"," ")})]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:n.descripcion}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:new Date(n.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:[n.total_productos," productos"]})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["$",n.total_valor.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:n.fecha_fin?`Finalizado ${new Date(n.fecha_fin).toLocaleDateString()}`:"En progreso"})]})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:()=>M(n.id),className:"inline-flex items-center px-3 py-2 text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",children:[e.jsx(Ve,{className:"w-4 h-4 mr-1"}),"Ver detalles"]})})]})},n.id))})]}),e.jsx(Q,{children:E&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gray-500 bg-opacity-75 backdrop-blur-sm",onClick:()=>S(null)}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"‚Äã"}),e.jsxs(I.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative inline-block w-full max-w-6xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl sm:align-middle",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Detalles del Inventario"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>{const n=t.find(i=>i.id===E);n&&G(n)},className:"inline-flex items-center px-3 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsx("button",{onClick:()=>S(null),className:"text-gray-400 hover:text-gray-600 transition-colors",children:"‚úï"})]})]}),x?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(J,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando detalles..."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"#"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"C√≥digo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio Unit."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subtotal"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map((n,i)=>{var v,A,q,H;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:i+1}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900",children:((v=n.productos)==null?void 0:v.Codigo)||"N/A"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:((A=n.productos)==null?void 0:A.Producto)||"Producto sin nombre"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:n.cantidad_contada})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",parseFloat(((q=n.precio_unitario)==null?void 0:q.toString())||"0").toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600",children:["$",parseFloat(((H=n.subtotal)==null?void 0:H.toString())||"0").toFixed(2)]})]},n.id)})})]})})]})]})})})]})]})},Vt=({isOpen:g,onClose:t,userEmail:h})=>{const[l,r]=a.useState("profile"),[s,d]=a.useState(""),[p,o]=a.useState(null),{profile:f,loginLogs:c,loading:b,saving:u,updateProfile:y,loadLoginLogs:w}=Ke();a.useEffect(()=>{f&&d(f.display_name||"")},[f]);const m=(x,C)=>{o({type:x,message:C}),setTimeout(()=>o(null),3e3)},N=async()=>{if(!s.trim()){m("error","El nombre no puede estar vac√≠o");return}await y({display_name:s.trim()})?m("success","Perfil actualizado correctamente"):m("error","Error al actualizar el perfil")},E=x=>new Date(x).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),S=x=>{if(!x)return"Sesi√≥n activa";const C=x.match(/(\d+):(\d+):(\d+)/);if(!C)return x;const[,P,$,L]=C,V=parseInt(P),M=parseInt($);return V>0?`${V}h ${M}m`:M>0?`${M}m`:`${L}s`},T=x=>x.includes("Chrome")?{browser:"Chrome",icon:"üåê"}:x.includes("Firefox")?{browser:"Firefox",icon:"ü¶ä"}:x.includes("Safari")?{browser:"Safari",icon:"üß≠"}:x.includes("Edge")?{browser:"Edge",icon:"üî∑"}:{browser:"Desconocido",icon:"‚ùì"},j=x=>{x.target===x.currentTarget&&t()};return g?e.jsx(Q,{children:e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",onClick:j,children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gray-500 bg-opacity-75 backdrop-blur-sm","aria-hidden":"true"}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"‚Äã"}),e.jsxs(I.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2},className:"relative inline-block w-full max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl sm:align-middle",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(pe,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Perfil de Usuario"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestiona tu informaci√≥n personal y revisa tu actividad"})]})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-lg",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>r("profile"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${l==="profile"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(pe,{className:"w-4 h-4 inline mr-2"}),"Perfil"]}),e.jsxs("button",{onClick:()=>r("logs"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${l==="logs"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Le,{className:"w-4 h-4 inline mr-2"}),"Actividad"]})]}),b?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(J,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando informaci√≥n..."})]}):e.jsxs(e.Fragment,{children:[l==="profile"&&e.jsx(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Informaci√≥n Personal"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre para mostrar"}),e.jsx("input",{type:"text",value:s,onChange:x=>d(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Juan P√©rez"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Este nombre aparecer√° en lugar de tu email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:h,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"El email no se puede cambiar"})]}),e.jsx("button",{onClick:N,disabled:u,className:"w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 animate-spin mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Informaci√≥n de la Cuenta"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cuenta creada:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:f?E(f.created_at):"Cargando..."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"√öltima actualizaci√≥n:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:f?E(f.updated_at):"Cargando..."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Rol:"}),e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"Administrador"]})]})]})]})]})}),l==="logs"&&e.jsxs(I.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Historial de Inicios de Sesi√≥n"}),e.jsx("button",{onClick:()=>w(20),className:"text-sm text-blue-600 hover:text-blue-800 transition-colors",children:"Cargar m√°s"})]}),c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Le,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sin actividad registrada"}),e.jsx("p",{className:"text-gray-500",children:"Los inicios de sesi√≥n aparecer√°n aqu√≠"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:c.map((x,C)=>{const P=T(x.user_agent||""),$=C===0&&!x.logout_time;return e.jsx("div",{className:`p-4 border rounded-lg ${$?"border-green-200 bg-green-50":"border-gray-200 bg-white"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-2xl",children:P.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:P.browser}),$&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full mr-1 animate-pulse"}),"Sesi√≥n actual"]})]}),e.jsxs("div",{className:"mt-1 space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),E(x.login_time)]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Duraci√≥n: ",S(x.session_duration)]}),x.ip_address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(bt,{className:"w-4 h-4 mr-2"}),"IP: ",x.ip_address]})]})]})]}),e.jsx("div",{className:"flex items-center",children:x.success?e.jsx(te,{className:"w-5 h-5 text-green-500"}):e.jsx(xe,{className:"w-5 h-5 text-red-500"})})]})},x.id)})})]})]}),e.jsx(Q,{children:p&&e.jsx(I.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:`fixed bottom-4 right-4 z-50 p-4 rounded-lg shadow-lg ${p.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[p.type==="success"?e.jsx(te,{className:"w-5 h-5"}):e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{children:p.message})]})})})]})]})})}):null},Ae="inventory_system_data",Rt=g=>{try{const t={inventory:g,timestamp:new Date().toISOString(),version:"1.0"};localStorage.setItem(Ae,JSON.stringify(t))}catch(t){console.error("‚ùå Error guardando inventario en localStorage:",t)}},Me=()=>{try{const g=localStorage.getItem(Ae);if(!g)return[];const t=JSON.parse(g);return t&&Array.isArray(t.inventory)?t.inventory.map(l=>({...l,scannedAt:new Date(l.scannedAt)})):Array.isArray(t)?t.map(l=>({...l,scannedAt:new Date(l.scannedAt)})):[]}catch(g){return console.error("‚ùå Error cargando inventario desde localStorage:",g),[]}},zt=()=>{const[g,t]=a.useState([]),[h,l]=a.useState(0),[r,s]=a.useState(null),[d,p]=a.useState(!0),[o,f]=a.useState(!1),[c,b]=a.useState([]),{user:u}=se(),y=async()=>{if(!(u!=null&&u.id)){p(!1);return}try{p(!0);const{data:x,error:C}=await F.from("inventarios").select("*").eq("usuario_id",u.id).eq("estado","en_progreso").order("created_at",{ascending:!1}).limit(1);if(C)throw C;let P;if(x&&x.length>0)P=x[0].id,console.log("üìã Inventario activo encontrado:",P);else{const{data:$,error:L}=await F.from("inventarios").insert({nombre:`Inventario ${new Date().toLocaleDateString()}`,descripcion:"Inventario creado autom√°ticamente",usuario_id:u.id,estado:"en_progreso"}).select().single();if(L)throw L;P=$.id,console.log("üìã Nuevo inventario creado:",P)}s(P),await w(P)}catch(x){console.error("‚ùå Error inicializando inventario:",x);const C=Me();C.length>0&&(t(C),console.log("üîÑ Inventario cargado desde localStorage como respaldo"))}finally{p(!1)}},w=async x=>{try{const{data:C,error:P}=await F.from("inventarios").select("items_data, descripcion").eq("id",x).single();if(!P&&(C!=null&&C.items_data)){const G=(C.items_data||[]).map(U=>({id:U.id,product:U.product,quantity:U.quantity,subtotal:U.subtotal,scannedAt:new Date(U.scannedAt)}));t(G),b(G),console.log("‚úÖ Items del inventario cargados desde JSON:",G.length,"entradas");return}console.log("üîÑ Cargando desde estructura antigua (items_inventario)");const{data:$,error:L}=await F.from("items_inventario").select(`
          id,
          cantidad_contada,
          precio_unitario,
          created_at,
          productos (
            id,
            codigo,
            nombre,
            precio,
            categoria,
            descripcion
          )
        `).eq("inventario_id",x).order("created_at",{ascending:!1});if(L)throw L;const V=($||[]).map(M=>({id:M.id,product:{id:M.productos.id,code:M.productos.codigo,name:M.productos.nombre,price:M.productos.precio,category:M.productos.categoria,description:M.productos.descripcion},quantity:M.cantidad_contada,subtotal:M.cantidad_contada*M.precio_unitario,scannedAt:new Date(M.created_at)}));t(V),b(V),console.log("‚úÖ Items del inventario cargados desde estructura antigua:",V.length,"entradas")}catch(C){console.error("‚ùå Error cargando items del inventario:",C);const P=Me();P.length>0&&(t(P),b(P),console.log("üîÑ Inventario cargado desde localStorage como respaldo"))}},m=async x=>{if(!(!r||!(u!=null&&u.id)))try{f(!0);const C=x.map($=>({id:$.id,product:$.product,quantity:$.quantity,subtotal:$.subtotal,scannedAt:$.scannedAt.toISOString()})),{error:P}=await F.from("inventarios").update({items_data:C,updated_at:new Date().toISOString()}).eq("id",r);if(!P){b([...x]),console.log("üíæ Inventario guardado en nueva estructura JSON:",x.length,"items");return}console.log("üîÑ Guardando en estructura antigua (items_inventario)"),await F.from("items_inventario").delete().eq("inventario_id",r);for(const $ of x){const{error:L}=await F.from("items_inventario").insert({inventario_id:r,producto_id:$.product.id,cantidad_contada:$.quantity,precio_unitario:$.product.price,created_at:$.scannedAt.toISOString()});L&&console.error("‚ùå Error insertando item:",L)}b([...x]),console.log("üíæ Inventario guardado en estructura antigua:",x.length,"items")}catch(C){console.error("‚ùå Error guardando inventario en base de datos:",C)}finally{f(!1)}};return a.useEffect(()=>{u!=null&&u.id?y():p(!1)},[u==null?void 0:u.id]),a.useEffect(()=>{const x=g.reduce((C,P)=>C+P.subtotal,0);if(l(x),Rt(g),!d&&g.length>0&&JSON.stringify(g)!==JSON.stringify(c)){const C=setTimeout(()=>{m(g)},1e3);return()=>clearTimeout(C)}},[g]),{inventory:g,total:h,isLoading:d,isSaving:o,currentInventoryId:r,addToInventory:async(x,C)=>{const P={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,product:x,quantity:C,subtotal:C*x.price,scannedAt:new Date};t($=>{const L=[P,...$];return console.log("‚ûï Producto agregado:",x.name,"Cantidad:",C),setTimeout(()=>m(L),100),L})},removeFromInventory:async x=>{t(C=>{const P=C.find(L=>L.id===x);P&&console.log("üóëÔ∏è Producto eliminado:",P.product.name);const $=C.filter(L=>L.id!==x);return setTimeout(()=>m($),100),$})},clearInventory:async()=>{if(console.log("üßπ Limpiando inventario completo"),t([]),r&&(u!=null&&u.id))try{const{error:x}=await F.from("inventarios").update({items_data:[],updated_at:new Date().toISOString()}).eq("id",r);x&&await F.from("items_inventario").delete().eq("inventario_id",r),b([]),console.log("üóëÔ∏è Inventario limpiado en base de datos")}catch(x){console.error("‚ùå Error limpiando inventario en base de datos:",x)}try{localStorage.removeItem(Ae),localStorage.removeItem("inventory")}catch(x){console.error("Error limpiando localStorage:",x)}},exportToExcel:()=>{const x=new Map;g.forEach(i=>{const v=i.product.code;if(x.has(v)){const A=x.get(v);A.totalQuantity+=i.quantity,A.totalSubtotal+=i.subtotal}else x.set(v,{product:i.product,totalQuantity:i.quantity,totalSubtotal:i.subtotal})});const C=Array.from(x.values()).reduce((i,v)=>i+v.totalQuantity,0),P=Array.from(x.values()).reduce((i,v)=>i+v.totalSubtotal,0),$=x.size,L=["#","C√≥digo","Producto","Cantidad","Precio","Subtotal"],V=Array.from(x.values()).map((i,v)=>[v+1,i.product.code,i.product.name,i.totalQuantity,`$${i.product.price.toFixed(2)}`,`$${i.totalSubtotal.toFixed(2)}`]),M=[["","","","","",""],["","","RESUMEN DEL INVENTARIO","","",""],["","","","","",""],["","","Total de productos √∫nicos:",$,"",""],["","","Total de items contados:",C,"",""],["","","Valor total del inventario:","","",`$${P.toFixed(2)}`],["","","","","",""],["","","Inventario generado el:",new Date().toLocaleDateString(),"",""],["","","Hora de generaci√≥n:",new Date().toLocaleTimeString(),"",""],["","","Usuario:",(u==null?void 0:u.username)||"Usuario","",""]],G=[L.join(","),...V.map(i=>i.join(",")),...M.map(i=>i.join(","))].join(`
`),U=new Blob([G],{type:"text/csv;charset=utf-8;"}),R=document.createElement("a"),n=URL.createObjectURL(U);R.setAttribute("href",n),R.setAttribute("download",`inventario_${(u==null?void 0:u.username)||"usuario"}_${new Date().toISOString().split("T")[0]}.csv`),R.style.visibility="hidden",document.body.appendChild(R),R.click(),document.body.removeChild(R)},completeInventory:async()=>{if(!(!r||!(u!=null&&u.id)))try{await m(g);const{error:x}=await F.from("inventarios").update({estado:"completado",fecha_fin:new Date().toISOString()}).eq("id",r);if(x)throw x;console.log("‚úÖ Inventario completado"),await y()}catch(x){console.error("‚ùå Error completando inventario:",x)}}}},Ut=()=>{const[g,t]=a.useState([]);return{products:g,searchProducts:async o=>{try{const{data:f,error:c}=await F.from("productos").select("id, Producto, Codigo, Codigo1, Codigo2, Codigo3, Codigo4, Precio").or(`Producto.ilike.%${o}%,Codigo.ilike.%${o}%,Codigo1.ilike.%${o}%,Codigo2.ilike.%${o}%,Codigo3.ilike.%${o}%,Codigo4.ilike.%${o}%`).limit(10);return c?(console.error("Error searching products:",c),[]):(f||[]).map(u=>({id:u.id.toString(),name:u.Producto,code:u.Codigo,price:parseFloat(u.Precio.toString()),category:"Producto"}))}catch(f){return console.error("Error searching products:",f),[]}},findProductByCode:async o=>{try{const{data:f,error:c}=await F.from("productos").select("*").or(`Codigo.eq.${o},Codigo1.eq.${o},Codigo2.eq.${o},Codigo3.eq.${o},Codigo4.eq.${o}`).limit(1);if(c||!f||f.length===0)return;const b=f[0];return{id:b.id.toString(),name:b.Producto,code:b.Codigo,code1:b.Codigo1,code2:b.Codigo2,code3:b.Codigo3,code4:b.Codigo4,price:parseFloat(b.Precio.toString()),category:"Producto"}}catch(f){console.error("Error finding product by code:",f);return}},getAllProducts:async()=>{try{const{data:o,error:f}=await F.from("productos").select("*").order("Producto");if(f)return console.error("Error fetching all products:",f),[];const c=(o||[]).map(b=>({id:b.id.toString(),name:b.Producto,code:b.Codigo,code1:b.Codigo1,code2:b.Codigo2,code3:b.Codigo3,code4:b.Codigo4,price:parseFloat(b.Precio.toString()),category:"Producto"}));return t(c),c}catch(o){return console.error("Error fetching products:",o),[]}},addProduct:o=>{console.log("Add product functionality handled by ProductManagement component")},updateProduct:(o,f)=>{console.log("Update product functionality handled by ProductManagement component")},deleteProduct:o=>{console.log("Delete product functionality handled by ProductManagement component")}}},Bt=({inventory:g,isSaving:t})=>{const[h,l]=a.useState(null),[r,s]=a.useState(!1);return a.useEffect(()=>{if(g.length>0){l(new Date),s(!0);const d=setTimeout(()=>s(!1),3e3);return()=>clearTimeout(d)}},[g.length]),t?e.jsxs(I.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"fixed top-20 right-4 z-40 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Guardando en base de datos..."})]}):!r||!h?null:e.jsxs(I.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"fixed top-20 right-4 z-40 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center space-x-2",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Guardado en base de datos ",h.toLocaleTimeString()]})]})},Gt=()=>{const[g,t]=a.useState("inventory"),[h,l]=a.useState(""),[r,s]=a.useState([]),[d,p]=a.useState(null),[o,f]=a.useState(!1),[c,b]=a.useState(!1),[u,y]=a.useState(!1),[w,m]=a.useState(!1),[N,E]=a.useState(!1),[S,T]=a.useState(!1),[j,x]=a.useState(!1),[C,P]=a.useState(""),$=le.useRef(null),{inventory:L,total:V,isLoading:M,isSaving:G,currentInventoryId:U,addToInventory:R,removeFromInventory:n,clearInventory:i,exportToExcel:v,completeInventory:A}=zt(),{searchProducts:q,findProductByCode:H}=Ut(),{user:ee}=se();a.useEffect(()=>{const z=setTimeout(()=>{$.current&&g==="inventory"&&$.current.focus()},100);return()=>clearTimeout(z)},[g]),a.useEffect(()=>{if(L.length>0&&g==="inventory"){const D=setTimeout(()=>{$.current&&$.current.focus()},300);return()=>clearTimeout(D)}},[L.length,g]);const B=[{title:"Productos en Inventario",value:L.length.toString(),change:L.length>0?"+"+L.length:"0",icon:K,color:"bg-blue-500"},{title:"Valor Total",value:`$${V.toFixed(2)}`,change:V>0?`$${V.toFixed(2)}`:"$0.00",icon:ie,color:"bg-green-500"},{title:"Productos √önicos",value:new Set(L.map(D=>D.product.id)).size.toString(),change:`${new Set(L.map(D=>D.product.id)).size} √∫nicos`,icon:te,color:"bg-purple-500"},{title:"√öltima Actualizaci√≥n",value:L.length>0?"Hace poco":"Sin datos",change:L.length>0?"Activo":"Inactivo",icon:Z,color:"bg-orange-500"}],W=D=>/^\d+$/.test(D.trim())&&D.trim().length>=6,k=async D=>{if(W(D)){const z=await H(D);if(z){p(z),f(!0),E(!1),l("");return}else{P(D),b(!0),E(!1),l("");return}}},_=D=>{l(D),D.trim().length>=2?(x(!0),T(!0)):(x(!1),T(!1),s([]),E(!1))},O=async D=>{const z=await H(D);z?(p(z),f(!0)):(P(D),b(!0))};a.useEffect(()=>{const z=setTimeout(async()=>{if(h.trim().length>=2&&j)try{if(W(h)){T(!1),x(!1),E(!1);return}const Y=await q(h);s(Y),Y.length===0&&h.length>=8,E(!0)}catch(Y){console.error("Error searching products:",Y),s([])}finally{T(!1),x(!1)}},300);return()=>clearTimeout(z)},[h,q,j]);const ae=D=>{j||l(D)},de=D=>{const z={id:D.id,name:D.name,code:D.code,price:D.price,category:D.category};p(z),f(!0),E(!1),l(""),x(!1),T(!1)},ne=()=>{var D,z;$.current&&((z=(D=$.current).clear)==null||z.call(D),$.current.focus())},ge=(D,z)=>{R(D,z),p(null),l(""),E(!1),x(!1),T(!1)},ue=(D,z)=>{R(D,z),P(""),l(""),E(!1),x(!1),T(!1),setTimeout(()=>{var Y,De;$.current&&((De=(Y=$.current).clear)==null||De.call(Y),$.current.focus())},200)},We=()=>{window.confirm("¬øEst√°s seguro de que quieres limpiar todo el inventario? Esta acci√≥n no se puede deshacer.")&&i()},ve=()=>{if(L.length===0){alert("No hay productos en el inventario para exportar.");return}const D=new Set(L.map(Y=>Y.product.code)).size,z=L.length;z>D&&!window.confirm(`Se encontraron ${z} items con ${D} productos √∫nicos.

Los productos duplicados se consolidar√°n autom√°ticamente en el archivo CSV.

¬øDeseas continuar con la exportaci√≥n?`)||v()},Ze=()=>{y(!0)},Xe=()=>{m(!0)};return g==="products"?e.jsx(_t,{onAddToInventory:R,onBackToInventory:()=>t("inventory")}):g==="history"?e.jsx(qt,{onBackToInventory:()=>t("inventory")}):M?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(J,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Cargando tu inventario"}),e.jsx("p",{className:"text-gray-600",children:"Conectando con la base de datos..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx(Te,{}),e.jsx(Bt,{inventory:L,isSaving:G}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Sistema de Inventario",U&&e.jsxs("span",{className:"text-lg text-blue-600 font-normal ml-2",children:["(ID: ",U.slice(-8),")"]})]}),e.jsx("p",{className:"text-gray-600",children:"Gestiona tu inventario de manera eficiente y moderna"})]}),e.jsxs("button",{onClick:()=>t("products"),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors mt-4 sm:mt-0",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Gestionar Productos"]}),e.jsxs("button",{onClick:()=>t("history"),className:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors mt-4 sm:mt-0",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Ver Historial"]})]}),e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:B.map((D,z)=>{const Y=D.icon;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${D.color}`,children:e.jsx(Y,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:D.change})]}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:D.value}),e.jsx("p",{className:"text-gray-600 text-sm",children:D.title})]},z)})}),e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(he,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Buscar Productos"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{ref:$,onSearch:ae,onInputChange:_,onEnter:k,placeholder:"Busca por nombre, c√≥digo o escane√°...",className:"w-full"}),N&&e.jsx(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute top-full left-0 right-0 z-10 mt-2 bg-white rounded-lg shadow-xl border border-gray-200 max-h-64 overflow-y-auto",children:S&&j?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Buscando productos..."})]}):r.length>0?e.jsx("div",{className:"py-2",children:r.map(D=>e.jsx("button",{onClick:()=>de(D),className:"w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors duration-150 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:D.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["C√≥digo: ",D.code]}),D.category&&e.jsx("span",{className:"inline-block mt-1 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full",children:D.category})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold text-green-600",children:["$",D.price.toFixed(2)]})})]})},D.id))}):!S&&h.trim().length>=8?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("p",{className:"text-gray-500 mb-3",children:"No se encontr√≥ el producto"}),e.jsxs("button",{onClick:()=>O(h),className:"inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),'Crear producto con c√≥digo "',h,'"']})]}):!S&&h.trim().length>=2&&h.trim().length<8?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No se encontraron productos"}):null})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Consejos de b√∫squeda:"}),e.jsxs("ul",{className:"text-sm text-blue-800 mt-1 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Puedes buscar por nombre o c√≥digo de barras"}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Para c√≥digos num√©ricos (6+ d√≠gitos):"})," Ingresa el c√≥digo y presiona Enter para b√∫squeda directa"]}),e.jsx("li",{children:"‚Ä¢ Puedes agregar el mismo producto varias veces (√∫til para diferentes √°reas)"}),e.jsx("li",{children:"‚Ä¢ Los productos duplicados se consolidan autom√°ticamente al exportar"}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"üíæ Tu inventario se guarda autom√°ticamente en la base de datos"})," - accede desde cualquier dispositivo"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"üéØ El cursor se posiciona autom√°ticamente en el buscador"})," para facilitar el escaneo continuo"]})]})]})]})})]}),e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(Tt,{inventory:L,onRemoveItem:n,onExport:ve,total:V})}),L.length>0&&e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"mt-8 bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(be,{className:"w-6 h-6 text-green-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Resumen del Inventario"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx(Be,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:L.length}),e.jsx("p",{className:"text-sm text-blue-700",children:"Total de Items"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx(ie,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["$",V.toFixed(2)]}),e.jsx("p",{className:"text-sm text-green-700",children:"Valor Total"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx(K,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:new Set(L.map(D=>D.product.id)).size}),e.jsx("p",{className:"text-sm text-purple-700",children:"Productos √önicos"})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:A,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"‚úÖ Completar Inventario"}),e.jsx("button",{onClick:ve,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"üìä Exportar Datos"})]})]})]}),e.jsx(At,{onClearInventory:We,onExport:ve,onShowHelp:Ze,onShowProfile:Xe,onCompleteInventory:A,onViewHistory:()=>t("history")}),e.jsx(It,{isOpen:o,onClose:()=>f(!1),product:d,onAddToInventory:ge,onModalClosed:ne}),e.jsx(Et,{isOpen:c,onClose:()=>b(!1),onProductCreated:ue,searchCode:C}),e.jsx(Dt,{isOpen:u,onClose:()=>y(!1)}),e.jsx(Vt,{isOpen:w,onClose:()=>m(!1),userEmail:(ee==null?void 0:ee.username)||""})]})},Ht=()=>{const{timeUntilLogout:g,logout:t}=se(),[h,l]=a.useState(!1),[r,s]=a.useState(0);a.useEffect(()=>{const f=Math.floor(g/6e4);f<=5&&f>0?(l(!0),s(g)):l(!1)},[g]),a.useEffect(()=>{if(h){const f=setInterval(()=>{s(c=>{const b=c-1e3;return b>0?b:0})},1e3);return()=>clearInterval(f)}},[h]);const d=f=>{const c=Math.floor(f/6e4),b=Math.floor(f%6e4/1e3);return`${c}:${b.toString().padStart(2,"0")}`},p=()=>{document.dispatchEvent(new Event("mousedown")),l(!1)},o=()=>{t()};return e.jsx(Q,{children:h&&e.jsx(I.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:"fixed bottom-4 right-4 z-50 max-w-sm",children:e.jsx("div",{className:"bg-white border border-yellow-300 rounded-lg shadow-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Z,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:"‚ö†Ô∏è Sesi√≥n por expirar"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Tu sesi√≥n expirar√° en ",e.jsx("strong",{className:"text-red-600",children:d(r)})," por inactividad."]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:p,className:"flex-1 inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"Extender"]}),e.jsxs("button",{onClick:o,className:"flex-1 inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"Salir"]})]})]}),e.jsx("button",{onClick:()=>l(!1),className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:"‚úï"})]})})})})},Jt=()=>{const[g,t]=a.useState(!0),{user:h,isLoading:l}=se(),r=()=>{t(!1)};return g?e.jsx(Pt,{onComplete:r}):l?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):h!=null&&h.isAuthenticated?e.jsxs(e.Fragment,{children:[e.jsx(Gt,{}),e.jsx(Ht,{})]}):e.jsx(kt,{})},Qt=()=>e.jsx(Ct,{children:e.jsx(Jt,{})});Ge(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(Qt,{})}));
